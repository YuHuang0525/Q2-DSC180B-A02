<!DOCTYPE html>
<html>

<head>
    <script type="text/javascript" src="https://npmcdn.com/parse/dist/parse.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/web3/1.2.7-rc.0/web3.min.js"></script>
    <link href="background.css" rel="stylesheet" type="text/css">
    <style>
        
        #myProgress {
            width: 100%;
            background-color: #ddd;
            opacity: 0;
        }

        #myBar {
            width: 0%;
            height: 40px;
            background-color: #51e7ec;
            text-align: center;
            line-height: 40px;
            color: white;
            opacity: 0;
        }

        .cool-input {
            display: block;
            width: 300px;
            padding: 10px;
            margin: 0 auto;
            font-size: 16px;
            border: 2px solid #ddd;
            border-radius: 10px;
            background-color: #f5f5f5;
            color: #333;
            outline: none;
        }
        .cool-input:focus {
            border-color: #5bc0de;
            box-shadow: 0 0 5px #5bc0de;
        }

        #addItem {
            display: inline-block;
            padding: 10px 20px;
            background-color: #007bff;
            color: white;
            font-size: 16px;
            border-radius: 25px;
            border: none;
            text-align: center;
            text-decoration: none;
            overflow: hidden;
            position: relative;
            animation-name: motivate;
            animation-duration: 3s;
            animation-iteration-count: infinite;
            animation-direction: alternate;
        }
        #addItem:hover {
            cursor: pointer;
            background-color: #2cd1fa;
        }
        @keyframes motivate {
            0% {
            transform: translateY(0);
            }
            20% {
            transform: translateY(-10px);
            }
            40% {
            transform: translateY(0);
            }
            60% {
            transform: translateY(-5px);
            }
            80% {
            transform: translateY(0);
            }
            100% {
            transform: translateY(-2px);
            }
        }

        body {
            background-color: rgb(16, 17, 17);
            font-family: Arial, sans-serif;
            font-size: 30px;
            display: flex;
            text-align: center;
            height: 200vh;
        }
        
        p {
            font-family: Arial, sans-serif;
            font-size: 28px;
            color:  #f0f1ec;
        }

        h1 {
            text-align: center;
            font-size: 3.0rem;
            font-weight: bold;
            margin-top: 10vh;

            /* Fallback: Set a background color. */
            background-color: white;
            
            /* Create the gradient. */
            background-image: linear-gradient(100deg, #f2f3ed, #4a62eb);
            
            /* Set the background size and repeat properties. */
            background-size: 100%;
            background-repeat: repeat;

            /* Use the text as a mask for the background. */
            /* This will show the gradient as a text color rather than element bg. */
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent; 
            -moz-background-clip: text;
            -moz-text-fill-color: transparent;
            
        }

        

        button {
            display: inline-block;
            background-color: #007bff;
            text-align: center;
            color: #fff;
            font-size: 1.5rem;
            padding: 1rem 2.5rem;
            border-radius: 5rem;
            border: none;
            margin: 0 1rem;
            cursor: pointer;
            box-shadow: 0 0.5rem #0069e0;
            transition: all 0.3s ease;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 0.8rem #0069e0;
        }

        #readArea {
            flex-basis: 50%;
        }

        #writeArea {
            flex-basis: 50%;
        }


    </style>

</head>

<body>
    
    <h1>Deploy New Contract</h1>

    <div id="readArea">
        <br>

        <button onclick="connectMetamask()">CONNECT TO METAMASK</button> <br>
        <p id="accountArea"></p>

        <button onclick="createMyOwnContract()">CREATE MY OWN CONTRACT</button> <br>
        <p id="contractDeployValue"></p>
        <input style="visibility: hidden;" type="text" class="cool-input" id="deployValue" placeholder="Enter the amount in Wei"> <br>
        <br>
        <button style="visibility: hidden;" id="deployContract" onclick="deployContract()">DEPLOY CONTRACT</button> <br>

        <p id="contractFollowMetamaskArea"></p>
        <p id="contractStartsDeployingArea"></p>
        <div id="myProgress">
            <div id="myBar">0%</div>
        </div>
        <p id="contractWaitingArea"></p>
        <p id="contractDeployStateArea"></p>
        <p id="contractAddressArea"></p>
        
        <p id="toContractDetail"></p>

        <button style="visibility: hidden;" id="addItem" onclick="location.href = 'sellerAddItemPage.html';">Add Item to My Contract</button>


    </div>

    <script>

        /* Ensure that the page starts at the top whenever refresh the page */
        window.onbeforeunload = function () {
            window.scrollTo(0, 0);
        }

        Parse.initialize("rgzBD2oDrFGwnP4GhepGqvLTb4zxUCVA8ISU94G6", "rbN8I2nlk462haH28HHxwAka3o02oVqWWz1PrFdi"); //PASTE HERE YOUR Back4App APPLICATION ID AND YOUR JavaScript KEY
        Parse.serverURL = "https://parseapi.back4app.com/";

        /* function that helps dynamically output text */

        function outputText(id, text) {

            var index = 0;
            var speed = 50;
            var container = document.getElementById(id);
            
            if (container.innerHTML !== "") {
                container = "";
            }

            var interval = setInterval(function() {
            if (index < text.length) {
                container.innerHTML += text.charAt(index);
                index++;
            } else {
                clearInterval(interval);
            }
            }, speed);
        }


        /* function that helps scroll down the html page*/
        function scrollToPosition(position, duration) {
        // Get the current scroll position
        var start = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop || 0;
        
        // Calculate the distance to scroll
        var distance = position - start;
        
        // Get the start time
        var startTime = null;
        
        function scroll(time) {
          if (startTime === null) {
            startTime = time;
          }
          
          var timeElapsed = time - startTime;
          var progress = Math.min(timeElapsed / duration, 1);
          var scrollTop = start + distance * easeInOutCubic(progress);
          window.scrollTo(0, scrollTop);
          
          if (timeElapsed < duration) {
            window.requestAnimationFrame(scroll);
          }
        }
        
        function easeInOutCubic(t) {
          return t < 0.5 ? 4 * t * t * t : (t - 1) * (2 * t - 2) * (2 * t - 2) + 1;
        }
        
        window.requestAnimationFrame(scroll);
        }
      
        function scrollDown() {
            var position = document.body.scrollHeight - window.innerHeight;
            var duration = 1700;
            scrollToPosition(position*0.2, duration);
        }
    


        let account;
        const connectMetamask = async () => {
            if (window.ethereum !== "undefined") {
                const accounts = await ethereum.request({ method: "eth_requestAccounts" });
                account = accounts[0];
                
                var text = `Hello Address: ${account}`;
                
                outputText("accountArea", text);

            }
            
        }

        let value = 0;
        const createMyOwnContract = async () => {

            var text = "Enter the amount you want to deploy to the contract below, it can be 0 for now and you can always add more balance to your contract later";

            outputText("contractDeployValue", text);
            
            scrollDown();

            document.getElementById("deployValue").style.visibility = "visible";

            document.getElementById("deployContract").style.visibility = "visible";

        }
    

        let contractAddress;
        const deployContract = async () => {

            value = document.getElementById("deployValue").value;

            var text = "Please follow through the Metamask page ";
            
            outputText("contractFollowMetamaskArea", text);
            
                                const ABI = [ { "inputs": [], "stateMutability": "payable", "type": "constructor" }, { "inputs": [], "name": "InvalidState", "type": "error" }, { "inputs": [], "name": "ItemNotAdded", "type": "error" }, { "inputs": [], "name": "OnlyBuyer", "type": "error" }, { "inputs": [], "name": "OnlySeller", "type": "error" }, { "inputs": [], "name": "ValueNotEven", "type": "error" }, { "inputs": [], "name": "notEnoughEscrow", "type": "error" }, { "anonymous": false, "inputs": [], "name": "ConfirmShipped", "type": "event" }, { "anonymous": false, "inputs": [], "name": "ItemReceived", "type": "event" }, { "anonymous": false, "inputs": [], "name": "PurchaseConfirmed", "type": "event" }, { "anonymous": false, "inputs": [], "name": "SellerRefunded", "type": "event" }, { "anonymous": false, "inputs": [], "name": "addedEscrow", "type": "event" }, { "anonymous": false, "inputs": [], "name": "closedContract", "type": "event" }, { "inputs": [], "name": "addEscrow", "outputs": [], "stateMutability": "payable", "type": "function" }, { "inputs": [ { "internalType": "uint256", "name": "inp_value", "type": "uint256" }, { "internalType": "string", "name": "inp_item_name", "type": "string" }, { "internalType": "string", "name": "inp_item_details", "type": "string" }, { "internalType": "string", "name": "inp_item_descriptions", "type": "string" } ], "name": "add_item", "outputs": [], "stateMutability": "nonpayable", "type": "function" }, { "inputs": [], "name": "buyerNumber", "outputs": [ { "internalType": "uint256", "name": "", "type": "uint256" } ], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "checkNoActiveBuyers", "outputs": [ { "internalType": "bool", "name": "", "type": "bool" } ], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "closeContract", "outputs": [], "stateMutability": "payable", "type": "function" }, { "inputs": [ { "internalType": "uint256", "name": "quant", "type": "uint256" } ], "name": "confirmPurchase", "outputs": [], "stateMutability": "payable", "type": "function" }, { "inputs": [], "name": "confirmReceived", "outputs": [], "stateMutability": "nonpayable", "type": "function" }, { "inputs": [ { "internalType": "address", "name": "address_", "type": "address" } ], "name": "confirmShipped", "outputs": [], "stateMutability": "payable", "type": "function" }, { "inputs": [], "name": "escrowLeft", "outputs": [ { "internalType": "uint256", "name": "", "type": "uint256" } ], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "getAddress", "outputs": [ { "internalType": "address", "name": "", "type": "address" } ], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "getBalance", "outputs": [ { "internalType": "uint256", "name": "", "type": "uint256" } ], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "getBuyerNumber", "outputs": [ { "internalType": "uint256", "name": "", "type": "uint256" } ], "stateMutability": "view", "type": "function" }, { "inputs": [ { "internalType": "address", "name": "addr", "type": "address" } ], "name": "getBuyerState", "outputs": [ { "internalType": "string", "name": "", "type": "string" } ], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "getEscrowLeft", "outputs": [ { "internalType": "uint256", "name": "", "type": "uint256" } ], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "getItemDescription", "outputs": [ { "internalType": "string", "name": "", "type": "string" } ], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "getItemDetails", "outputs": [ { "internalType": "string", "name": "", "type": "string" } ], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "getItemName", "outputs": [ { "internalType": "string", "name": "", "type": "string" } ], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "getItemPriceInWEI", "outputs": [ { "internalType": "string", "name": "", "type": "string" } ], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "getQuantity", "outputs": [ { "internalType": "uint256", "name": "", "type": "uint256" } ], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "getValue", "outputs": [ { "internalType": "uint256", "name": "", "type": "uint256" } ], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "quantity", "outputs": [ { "internalType": "uint256", "name": "", "type": "uint256" } ], "stateMutability": "view", "type": "function" }, { "inputs": [ { "internalType": "address", "name": "item_received_buyer", "type": "address" } ], "name": "refundSeller", "outputs": [], "stateMutability": "nonpayable", "type": "function" }, { "inputs": [], "name": "seller", "outputs": [ { "internalType": "address payable", "name": "", "type": "address" } ], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "value", "outputs": [ { "internalType": "uint256", "name": "", "type": "uint256" } ], "stateMutability": "view", "type": "function" } ];


            const sellerAddress = account;
            var code = "0x60806040526000600255600a6004556000600960006101000a81548160ff0219169083151502179055506000600960016101000a81548160ff02191690831515021790555033600960026101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550346001819055506126fd8061009b6000396000f3fe60806040526004361061014b5760003560e01c806361b53cdc116100b6578063a0e9ec291161006f578063a0e9ec29146103de578063b905ebaa14610409578063bd4e219414610446578063c819d85a14610471578063e38060291461049c578063f7fb44cd146104c75761014b565b806361b53cdc1461032457806362a759071461034d578063708ddcf31461036957806373fac6f0146103735780637c81d1231461038a578063977b4906146103b55761014b565b806338cc48311161010857806338cc48311461025257806339e878891461027d5780633fa4f245146102a8578063408b9945146102d35780634d24e902146102fe578063610be6541461031a5761014b565b80630115949c1461015057806308551a531461017b57806312065fe0146101a657806317fc45e2146101d15780631a5c0730146101fc5780632096525514610227575b600080fd5b34801561015c57600080fd5b506101656104f2565b6040516101729190611d08565b60405180910390f35b34801561018757600080fd5b506101906104fc565b60405161019d9190611d64565b60405180910390f35b3480156101b257600080fd5b506101bb610522565b6040516101c89190611d08565b60405180910390f35b3480156101dd57600080fd5b506101e661052a565b6040516101f39190611d08565b60405180910390f35b34801561020857600080fd5b50610211610530565b60405161021e9190611d9a565b60405180910390f35b34801561023357600080fd5b5061023c61062a565b6040516102499190611d08565b60405180910390f35b34801561025e57600080fd5b50610267610633565b6040516102749190611dd6565b60405180910390f35b34801561028957600080fd5b5061029261063b565b60405161029f9190611e81565b60405180910390f35b3480156102b457600080fd5b506102bd6106cd565b6040516102ca9190611d08565b60405180910390f35b3480156102df57600080fd5b506102e86106d3565b6040516102f59190611d08565b60405180910390f35b61031860048036038101906103139190611ee3565b6106dd565b005b610322610a30565b005b34801561033057600080fd5b5061034b60048036038101906103469190611f3c565b610b7c565b005b61036760048036038101906103629190611f3c565b610e77565b005b610371611049565b005b34801561037f57600080fd5b5061038861116b565b005b34801561039657600080fd5b5061039f6113d2565b6040516103ac9190611e81565b60405180910390f35b3480156103c157600080fd5b506103dc60048036038101906103d7919061209e565b611464565b005b3480156103ea57600080fd5b506103f3611530565b6040516104009190611e81565b60405180910390f35b34801561041557600080fd5b50610430600480360381019061042b9190611f3c565b6115c2565b60405161043d9190611e81565b60405180910390f35b34801561045257600080fd5b5061045b61176e565b6040516104689190611d08565b60405180910390f35b34801561047d57600080fd5b50610486611774565b6040516104939190611e81565b60405180910390f35b3480156104a857600080fd5b506104b1611806565b6040516104be9190611d08565b60405180910390f35b3480156104d357600080fd5b506104dc61180c565b6040516104e99190611d08565b60405180910390f35b6000600354905090565b600960029054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b600047905090565b60035481565b6000806001905060005b600b80549050811015610622576000600b828154811061055d5761055c612159565b5b9060005260206000200160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16905060028081111561059d5761059c612188565b5b600a60008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060000160149054906101000a900460ff1660028111156105ff576105fe612188565b5b1461060e576000925050610622565b50808061061a906121e6565b91505061053a565b508091505090565b60008054905090565b600030905090565b60606008805461064a9061225d565b80601f01602080910402602001604051908101604052809291908181526020018280546106769061225d565b80156106c35780601f10610698576101008083540402835291602001916106c3565b820191906000526020600020905b8154815290600101906020018083116106a657829003601f168201915b5050505050905090565b60005481565b6000600254905090565b600960029054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1603610764576040517f86efbb5500000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b600960019054906101000a900460ff166107aa576040517f4330c19800000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b60025460005460026001546107bf91906122bd565b6107c991906122bd565b11610800576040517ffa59aa5c00000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b6003548111158061081057600080fd5b600454600254108061082157600080fd5b600960009054906101000a900460ff16158061083c57600080fd5b83600054600261084c91906122ee565b61085691906122ee565b34148061086257600080fd5b84600360008282546108749190612330565b925050819055506002600081548092919061088e906121e6565b9190505550600b339080600181540180825580915050600190039060005260206000200160009091909190916101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555060405180606001604052803373ffffffffffffffffffffffffffffffffffffffff1681526020016000600281111561093157610930612188565b5b815260200186815250600a60003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008201518160000160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555060208201518160000160146101000a81548160ff021916908360028111156109eb576109ea612188565b5b0217905550604082015181600101559050507fd5d55c8a68912e9a110618df8d5e2e83b8d83211c57a8ddd1203df92885dc88160405160405180910390a15050505050565b600960029054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614610ab7576040517f85d1f72600000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b610abf610530565b80610ac957600080fd5b6001600960006101000a81548160ff021916908315150217905550600960029054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166108fc479081150290604051600060405180830381858888f19350505050158015610b4c573d6000803e3d6000fd5b507f76685d578223d8852db93c5274d5fcf6e1146fd0a64794bd61450d94e4a68db760405160405180910390a150565b600960029054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614610c03576040517f85d1f72600000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b806002806002811115610c1957610c18612188565b5b600a60008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060000160149054906101000a900460ff166002811115610c7b57610c7a612188565b5b14610cb2576040517fbaf3f0f700000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b7ffda69c32bcfdba840a167777906b173b607eb8b4d8853b97a80d26e613d858db60405160405180910390a160026000815480929190610cf190612364565b91905055506000600a60008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600101549050600960029054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166108fc826000546003610d8991906122ee565b610d9391906122ee565b9081150290604051600060405180830381858888f19350505050158015610dbe573d6000803e3d6000fd5b50806002600054610dcf91906122ee565b610dd991906122ee565b600154610de69190612330565b600181905550600a60008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600080820160006101000a81549073ffffffffffffffffffffffffffffffffffffffff02191690556000820160146101000a81549060ff02191690556001820160009055505050505050565b600960029054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614610efe576040517f85d1f72600000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b806000806002811115610f1457610f13612188565b5b600a60008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060000160149054906101000a900460ff166002811115610f7657610f75612188565b5b14610fad576040517fbaf3f0f700000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b7fe88a499366edd85624840c77defbb45744582b650f2424cbf1f787d8cde0af9060405160405180910390a16001600a60008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060000160146101000a81548160ff0219169083600281111561103f5761103e612188565b5b0217905550505050565b600960029054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16146110d0576040517f85d1f72600000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b60005460026110df91906122ee565b341015806110ec57600080fd5b600080546002346110fd91906122bd565b61110791906122bd565b9050806003600082825461111b919061238d565b925050819055503460016000828254611134919061238d565b925050819055507f5b0ad5b6591b53a9520a0e0ca3d6293496d11bf227db2b819e7c0e0ab8500a7360405160405180910390a15050565b600960029054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16036111f2576040517f86efbb5500000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b33600180600281111561120857611207612188565b5b600a60008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060000160149054906101000a900460ff16600281111561126a57611269612188565b5b146112a1576040517fbaf3f0f700000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b7fe89152acd703c9d8c7d28829d443260b411454d45394e7995815140c8cbcbcf760405160405180910390a16002600a60003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060000160146101000a81548160ff0219169083600281111561133357611332612188565b5b02179055503373ffffffffffffffffffffffffffffffffffffffff166108fc600a60003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600101546000546113a291906122ee565b9081150290604051600060405180830381858888f193505050501580156113cd573d6000803e3d6000fd5b505050565b6060600780546113e19061225d565b80601f016020809104026020016040519081016040528092919081815260200182805461140d9061225d565b801561145a5780601f1061142f5761010080835404028352916020019161145a565b820191906000526020600020905b81548152906001019060200180831161143d57829003601f168201915b5050505050905090565b600960029054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16146114eb576040517f85d1f72600000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b6114f484611816565b6114fd83611900565b6115068261199a565b61150f81611a34565b6001600960016101000a81548160ff02191690831515021790555050505050565b60606005805461153f9061225d565b80601f016020809104026020016040519081016040528092919081815260200182805461156b9061225d565b80156115b85780601f1061158d576101008083540402835291602001916115b8565b820191906000526020600020905b81548152906001019060200180831161159b57829003601f168201915b5050505050905090565b60606000600a60008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060000160149054906101000a900460ff1690506000600281111561162c5761162b612188565b5b81600281111561163f5761163e612188565b5b03611682576040518060400160405280600481526020017f7061696400000000000000000000000000000000000000000000000000000000815250915050611769565b6001600281111561169657611695612188565b5b8160028111156116a9576116a8612188565b5b036116ec576040518060400160405280600781526020017f7368697070656400000000000000000000000000000000000000000000000000815250915050611769565b6002808111156116ff576116fe612188565b5b81600281111561171257611711612188565b5b03611755576040518060400160405280600881526020017f7265636569766564000000000000000000000000000000000000000000000000815250915050611769565b604051806020016040528060008152509150505b919050565b60025481565b6060600680546117839061225d565b80601f01602080910402602001604051908101604052809291908181526020018280546117af9061225d565b80156117fc5780601f106117d1576101008083540402835291602001916117fc565b820191906000526020600020905b8154815290600101906020018083116117df57829003601f168201915b5050505050905090565b60015481565b6000600154905090565b600960029054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff161461189d576040517f85d1f72600000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b8060008190555060026000546001546118b691906122bd565b6118c091906122bd565b6003819055506118cf81611ace565b6040516020016118df9190612423565b604051602081830303815290604052600590816118fc91906125f5565b5050565b600960029054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614611987576040517f85d1f72600000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b806006908161199691906125f5565b5050565b600960029054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614611a21576040517f85d1f72600000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b8060079081611a3091906125f5565b5050565b600960029054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614611abb576040517f85d1f72600000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b8060089081611aca91906125f5565b5050565b606060006001611add84611b9c565b01905060008167ffffffffffffffff811115611afc57611afb611f73565b5b6040519080825280601f01601f191660200182016040528015611b2e5781602001600182028036833780820191505090505b509050600082602001820190505b600115611b91578080600190039150507f3031323334353637383961626364656600000000000000000000000000000000600a86061a8153600a8581611b8557611b8461228e565b5b04945060008503611b3c575b819350505050919050565b600080600090507a184f03e93ff9f4daa797ed6e38ed64bf6a1f0100000000000000008310611bfa577a184f03e93ff9f4daa797ed6e38ed64bf6a1f0100000000000000008381611bf057611bef61228e565b5b0492506040810190505b6d04ee2d6d415b85acef81000000008310611c37576d04ee2d6d415b85acef81000000008381611c2d57611c2c61228e565b5b0492506020810190505b662386f26fc100008310611c6657662386f26fc100008381611c5c57611c5b61228e565b5b0492506010810190505b6305f5e1008310611c8f576305f5e1008381611c8557611c8461228e565b5b0492506008810190505b6127108310611cb4576127108381611caa57611ca961228e565b5b0492506004810190505b60648310611cd75760648381611ccd57611ccc61228e565b5b0492506002810190505b600a8310611ce6576001810190505b80915050919050565b6000819050919050565b611d0281611cef565b82525050565b6000602082019050611d1d6000830184611cf9565b92915050565b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b6000611d4e82611d23565b9050919050565b611d5e81611d43565b82525050565b6000602082019050611d796000830184611d55565b92915050565b60008115159050919050565b611d9481611d7f565b82525050565b6000602082019050611daf6000830184611d8b565b92915050565b6000611dc082611d23565b9050919050565b611dd081611db5565b82525050565b6000602082019050611deb6000830184611dc7565b92915050565b600081519050919050565b600082825260208201905092915050565b60005b83811015611e2b578082015181840152602081019050611e10565b60008484015250505050565b6000601f19601f8301169050919050565b6000611e5382611df1565b611e5d8185611dfc565b9350611e6d818560208601611e0d565b611e7681611e37565b840191505092915050565b60006020820190508181036000830152611e9b8184611e48565b905092915050565b6000604051905090565b600080fd5b600080fd5b611ec081611cef565b8114611ecb57600080fd5b50565b600081359050611edd81611eb7565b92915050565b600060208284031215611ef957611ef8611ead565b5b6000611f0784828501611ece565b91505092915050565b611f1981611db5565b8114611f2457600080fd5b50565b600081359050611f3681611f10565b92915050565b600060208284031215611f5257611f51611ead565b5b6000611f6084828501611f27565b91505092915050565b600080fd5b600080fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052604160045260246000fd5b611fab82611e37565b810181811067ffffffffffffffff82111715611fca57611fc9611f73565b5b80604052505050565b6000611fdd611ea3565b9050611fe98282611fa2565b919050565b600067ffffffffffffffff82111561200957612008611f73565b5b61201282611e37565b9050602081019050919050565b82818337600083830152505050565b600061204161203c84611fee565b611fd3565b90508281526020810184848401111561205d5761205c611f6e565b5b61206884828561201f565b509392505050565b600082601f83011261208557612084611f69565b5b813561209584826020860161202e565b91505092915050565b600080600080608085870312156120b8576120b7611ead565b5b60006120c687828801611ece565b945050602085013567ffffffffffffffff8111156120e7576120e6611eb2565b5b6120f387828801612070565b935050604085013567ffffffffffffffff81111561211457612113611eb2565b5b61212087828801612070565b925050606085013567ffffffffffffffff81111561214157612140611eb2565b5b61214d87828801612070565b91505092959194509250565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052603260045260246000fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602160045260246000fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601160045260246000fd5b60006121f182611cef565b91507fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff8203612223576122226121b7565b5b600182019050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602260045260246000fd5b6000600282049050600182168061227557607f821691505b6020821081036122885761228761222e565b5b50919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601260045260246000fd5b60006122c882611cef565b91506122d383611cef565b9250826122e3576122e261228e565b5b828204905092915050565b60006122f982611cef565b915061230483611cef565b925082820261231281611cef565b91508282048414831517612329576123286121b7565b5b5092915050565b600061233b82611cef565b915061234683611cef565b925082820390508181111561235e5761235d6121b7565b5b92915050565b600061236f82611cef565b915060008203612382576123816121b7565b5b600182039050919050565b600061239882611cef565b91506123a383611cef565b92508282019050808211156123bb576123ba6121b7565b5b92915050565b600081905092915050565b60006123d782611df1565b6123e181856123c1565b93506123f1818560208601611e0d565b80840191505092915050565b7f2057656900000000000000000000000000000000000000000000000000000000815250565b600061242f82846123cc565b915061243a826123fd565b60048201915081905092915050565b60008190508160005260206000209050919050565b60006020601f8301049050919050565b600082821b905092915050565b6000600883026124ab7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff8261246e565b6124b5868361246e565b95508019841693508086168417925050509392505050565b6000819050919050565b60006124f26124ed6124e884611cef565b6124cd565b611cef565b9050919050565b6000819050919050565b61250c836124d7565b612520612518826124f9565b84845461247b565b825550505050565b600090565b612535612528565b612540818484612503565b505050565b5b818110156125645761255960008261252d565b600181019050612546565b5050565b601f8211156125a95761257a81612449565b6125838461245e565b81016020851015612592578190505b6125a661259e8561245e565b830182612545565b50505b505050565b600082821c905092915050565b60006125cc600019846008026125ae565b1980831691505092915050565b60006125e583836125bb565b9150826002028217905092915050565b6125fe82611df1565b67ffffffffffffffff81111561261757612616611f73565b5b612621825461225d565b61262c828285612568565b600060209050601f83116001811461265f576000841561264d578287015190505b61265785826125d9565b8655506126bf565b601f19841661266d86612449565b60005b8281101561269557848901518255600182019150602085019450602081019050612670565b868310156126b257848901516126ae601f8916826125bb565b8355505b6001600288020188555050505b50505050505056fea2646970667358221220fbc7f450e21106862f3ff6b6ea4bdd2899c54ca3beca864c3d44a31513ea7e0664736f6c63430008110033";

            /*const Address = "0x182cc93685355256d9c782dcd8d5e5b43016277c";
            window.web3 = await new Web3(window.ethereum);
            window.contract = await new window.web3.eth.Contract(ABI, Address); */
            

            window.web3 = await new Web3(window.ethereum);


            window.web3.eth.sendTransaction({
                from: sellerAddress,
                data: code,
                value: value
            }).on('transactionHash', async function (hash) {
                text = "Contract is now deploying, please wait";
                outputText("contractStartsDeployingArea", text);
                
                await move();

            }).on("receipt", async function (receipt) {
                if (receipt.status == false) {
                    text = "Contract-deploy fails, please check your Metamask page for more details";
                    outputText("contractDeployStateArea", text);
                } else {


                    await move_finish();

                    text = "Contract-deploy successful!";
                    outputText("contractDeployStateArea", text);

                    contractAddress = receipt.contractAddress;

                    text = "Here is your unique contract address: " + contractAddress;
                    outputText("contractAddressArea", text);

                    // store the contract address to the database
                    pushSellerContract(sellerAddress, contractAddress); 
                    
                    // store the contract address and seller address to local storage and ensure the next page can access them
                    localStorage.setItem('contractAddress', contractAddress);
                    localStorage.setItem('sellerAddress', account);

                    var button = document.getElementById("addItem");
                    button.style.visibility = "visible";
                    
                }
                
            });
            
            /* funtion of the moving bar */
            async function move() {
                var text = document.getElementById("myProgress");
                var elem = document.getElementById("myBar");
                text.style.opacity = 1.0;
                elem.style.opacity = 1.0;
                
                i = 1;
                var width = 10;
                var id = setInterval(frame, 10);
                function frame() {
                if (width >= 90) {
                    clearInterval(id);
                    i = 0;
                } else {
                    width = width + 0.07;
                    elem.style.width = width + "%";
                    elem.innerHTML = Number((width).toFixed(1))  + "%";
                    }   
                }
                
            }
            
            async function move_finish() {
                var text = document.getElementById("myProgress");
                var elem = document.getElementById("myBar");
                text.style.opacity = 1.0;
                elem.style.opacity = 1.0;
                
                i = 1;
                var width = 90;
                var id = setInterval(frame, 10);
                function frame() {
                if (width >= 100) {
                    clearInterval(id);
                    i = 0;
                } else {
                    width = width + 0.08;
                    elem.style.width = width + "%";
                    elem.innerHTML = Number((width).toFixed(1))  + "%";
                    }   
                }
                
            }
            
            async function pushSellerContract(sellerAddress, contractAddress) {

                const sellerContract = new Parse.Object("sellerContract");
   
                sellerContract.set("sellerAddress", sellerAddress);
                sellerContract.set("contractAddress", contractAddress);

                try {
                    let result = await sellerContract.save();

                } catch (error) {
                    alert(`Error: ${error.message}`);

                }
            } 
            
        }

        

    </script>

</body>

</html>