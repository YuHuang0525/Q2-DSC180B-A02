<!DOCTYPE html>
<html>

<head>
    <script type="text/javascript" src="https://npmcdn.com/parse/dist/parse.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/web3/1.2.7-rc.0/web3.min.js"></script>
    <link href="background.css" rel="stylesheet" type="text/css">

    <!-- Bootstrap CSS -->

    <link rel="stylesheet" href="assets/css/vendor/bootstrap.min.css">
    <link rel="stylesheet" href="assets/css/vendor/font-awesome.css">
    <link rel="stylesheet" href="assets/css/vendor/flaticon/flaticon.css">
    <link rel="stylesheet" href="assets/css/vendor/slick.css">
    <link rel="stylesheet" href="assets/css/vendor/slick-theme.css">
    <link rel="stylesheet" href="assets/css/vendor/jquery-ui.min.css">
    <link rel="stylesheet" href="assets/css/vendor/sal.css">
    <link rel="stylesheet" href="assets/css/vendor/magnific-popup.css">
    <link rel="stylesheet" href="assets/css/vendor/base.css">
    <link rel="stylesheet" href="assets/css/style.min.css">

    <style>
		body {
			background-color: #1e1e1e;
			color: #fff;
			font-family: 'Roboto', sans-serif;
			font-size: 16px;
		}
		h1 {
			font-size: 36px;
			font-weight: bold;
			color: #fff;
			text-align: center;
			margin-top: 50px;
			margin-bottom: 30px;
		}
		#readArea {
			margin: 0 auto;
			max-width: 800px;
			text-align: center;
		}
		button {
			background-color: #007bff;
			border: none;
			border-radius: 5px;
			color: #fff;
			cursor: pointer;
			font-size: 18px;
			font-weight: bold;
			margin-bottom: 20px;
			padding: 10px 30px;
            box-shadow: 0 0.5rem #0069e0;
			transition: background-color 0.3s ease-in-out;
		}
		button:hover {
			transform: translateY(-2px);
            box-shadow: 0 0.8rem #0069e0;
		}

        ::placeholder {
            color: rgb(240, 238, 235);
            text-align: center;
        }

		.cool-input {
			background-color: transparent;
			border: none;
			border-bottom: 2px solid #fff;
			color: #f5f0f0;
			font-size: 18px;
			margin-bottom: 20px;
			padding: 10px;
			width: 50%;
		}
		#cost, #deployValueText {
			font-size: 24px;
			font-weight: bold;
			margin-top: 30px;
		}
		#deployValue {
			background-color: #ecb44f;
			border: none;
			border-radius: 5px;
			color: #fff;
			cursor: pointer;
			font-size: 18px;
			font-weight: bold;
			margin-top: 20px;
			padding: 10px 30px;
			transition: background-color 0.3s ease-in-out;
		}
		#deployValue:hover {
			background-color: #c99134;
		}
		#deployContract, #addItem {
			background-color: #19d852;
			border: none;
			border-radius: 5px;
			color: #fff;
			cursor: pointer;
			font-size: 18px;
			font-weight: bold;
			margin-top: 20px;
			padding: 10px 30px;
			transition: background-color 0.3s ease-in-out;
		}
		#deployContract:hover, #addItem:hover {
			background-color: #149c0f;
		}
		#myProgress {
			background-color: #ddd;
			border-radius: 5px;
			height: 40px;
			margin-top: 20px;
			overflow: hidden;
			width: 100%;
            opacity: 0;
		}
		#myBar {
			background-color: #51e7ec;
			height: 40px;
			line-height: 40px;
			text-align: center;
			transition: width 0.3s ease-in-out;
			width: 0%;
            opacity: 0;
		}
		#contractWaitingArea {
			margin-top: 20px;
		}
		#contractDeployStateArea {
			margin-top: 20px;
		}
		#toContractDetail {
			margin-top: 20px;
		}
	</style>
</head>
<body class="sticky-header">
    <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
<![endif]-->
    <a href="#top" class="back-to-top" id="backto-top"><i class="fal fa-arrow-up"></i></a>
    <!-- Start Header -->
    <header class="header axil-header header-style-5">
        
        <!-- Start Mainmenu Area  -->
        <div id="axil-sticky-placeholder"></div>
        <div class="axil-mainmenu">
            <div class="container">
                <div class="header-navbar">
                    <div class="header-brand">

                        <!-- will include our logo below when ready -->
                        <!-- <a href="index.html" class="logo logo-dark">
                            <img src="assets/images/logo/logo.png" alt="Site Logo">
                        </a>
                        <a href="index.html" class="logo logo-light">
                            <img src="assets/images/logo/logo-light.png" alt="Site Logo">
                        </a> -->


                    </div>
                    <div class="header-main-nav">
                        <!-- Start Mainmanu Nav -->
                        <!-- <nav class="mainmenu-nav">
                            <button class="mobile-close-btn mobile-nav-toggler"><i class="fas fa-times"></i></button>
                            <div class="mobile-nav-brand">
                                <a href="index.html" class="logo">
                                    <img src="assets/images/logo/logo.png" alt="Site Logo">
                                </a>
                            </div>
                            <ul class="mainmenu">
                            </ul>
                        </nav> -->
                        <!-- End Mainmanu Nav -->
                    </div>
                    <div class="header-action">
                        <ul class="action-list">
                            <li class="my-account">
                                <a href="javascript:void(0)" >
                                    <i class="flaticon-person" style="color:rgb(244, 245, 242)"></i>
                                </a>
                                <div class="my-account-dropdown">
                                    <span class="title">QUICKLINKS</span>
                                    <ul>
                                        <!-- <li>
                                            <a href="my-account.html">My Account</a>
                                        </li> -->
                                        <li>
                                            <a href="homePage.html">Home</a>
                                        </li>
                                        <li>
                                          <a href="marketplace.html">Shop the Marketplace</a>
                                        </li>
                                        <li>
                                            <a href="sellerActiveContracts.html">My Active Contracts as Seller</a>
                                        </li>
                                        <li>
                                            <a href="buyerActiveContract.html">My Active Contracts as Buyer</a>
                                        </li>
                                    </ul>
                                </div>
                            </li>
                            <li class="axil-mobile-toggle">
                                <button class="menu-btn mobile-nav-toggler">
                                    <i class="flaticon-menu-2"></i>
                                </button>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <!-- End Mainmenu Area -->
    </header>



<body>
    
    <h1>Deploy New Contract</h1>

    <div id="readArea">
        <br>

        <button onclick="connectMetamask()">CONNECT TO METAMASK</button> <br>
        <p id="accountArea"></p>

        <button onclick="createMyOwnContract()">CREATE MY OWN CONTRACT</button> <br>
        <p id="contractDeployValue"></p>
        <input style="visibility: hidden;" type="text" class="cool-input" id="deployPrice" placeholder="Enter the price of one item in Wei"> <br>
        <br>
        <input style="visibility: hidden;" type="text" class="cool-input" id="deployQuant" placeholder="Enter the total quantity to sell"> <br>
        <br>
        <!-- <input style="visibility: hidden;" type="text" class="cool-input" id="deployValue"> <br> -->
        <button style="visibility: hidden" id = "deployValue" onclick="calculateDeployValue()" >CALCULATE FOR ME </button><br>
        <br>
        <p id="cost"></p>
        <p id="deployValueText"></p>
        <button style="visibility: hidden;" id="deployContract" onclick="deployContract()">DEPLOY CONTRACT</button> 
        <br>

        <p id="contractFollowMetamaskArea"></p>
        <p id="contractStartsDeployingArea"></p>
        <div id="myProgress">
            <div id="myBar">0%</div>
        </div>
        <p id="contractWaitingArea"></p>
        <p id="contractDeployStateArea"></p>
        <p id="contractAddressArea"></p>
        
        <p id="toContractDetail"></p>

        <button style="visibility: hidden;" id="addItem" onclick="location.href = 'sellerAddItemPage.html';">Add Item to My Contract</button>


    </div>

    <script>

        /* Ensure that the page starts at the top whenever refresh the page */
        window.onbeforeunload = function () {
            window.scrollTo(0, 0);
        }

        Parse.initialize("rgzBD2oDrFGwnP4GhepGqvLTb4zxUCVA8ISU94G6", "rbN8I2nlk462haH28HHxwAka3o02oVqWWz1PrFdi"); //PASTE HERE YOUR Back4App APPLICATION ID AND YOUR JavaScript KEY
        Parse.serverURL = "https://parseapi.back4app.com/";

        /* function that helps dynamically output text */

        function outputText(id, text) {

            var index = 0;
            var speed = 30;
            var container = document.getElementById(id);
            
            if (container.innerHTML !== "") {
                container.innerHTML = "";
            }

            var interval = setInterval(function() {
            if (index < text.length) {
                container.innerHTML += text.charAt(index);
                index++;
            } else {
                clearInterval(interval);
            }
            }, speed);
        }


        /* function that helps scroll down the html page*/
        function scrollToPosition(position, duration) {
        // Get the current scroll position
        var start = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop || 0;
        
        // Calculate the distance to scroll
        var distance = position - start;
        
        // Get the start time
        var startTime = null;
        
        function scroll(time) {
          if (startTime === null) {
            startTime = time;
          }
          
          var timeElapsed = time - startTime;
          var progress = Math.min(timeElapsed / duration, 1);
          var scrollTop = start + distance * easeInOutCubic(progress);
          window.scrollTo(0, scrollTop);
          
          if (timeElapsed < duration) {
            window.requestAnimationFrame(scroll);
          }
        }
        
        function easeInOutCubic(t) {
          return t < 0.5 ? 4 * t * t * t : (t - 1) * (2 * t - 2) * (2 * t - 2) + 1;
        }
        
        window.requestAnimationFrame(scroll);
        }
      
        function scrollDown() {
            var position = document.body.scrollHeight - window.innerHeight;
            var duration = 1700;
            scrollToPosition(position*0.2, duration);
        }
    


        let account;
        const connectMetamask = async () => {
            if (window.ethereum !== "undefined") {
                const accounts = await ethereum.request({ method: "eth_requestAccounts" });
                account = accounts[0];
                
                var text = `Hello Address: ${account}`;
                
                outputText("accountArea", text);

            }
            
        }

        let quant;
        let price;
        const createMyOwnContract = async () => {


            var text = "Enter the price of one item and the total quantity you want to sell, we will calculate the total amount of escrow you need to depoly";

            outputText("contractDeployValue", text);
            
            scrollDown();

 
            document.getElementById("deployPrice").style.visibility = "visible";
            document.getElementById("deployQuant").style.visibility = "visible";
            


            document.getElementById("deployContract").style.visibility = "visible";
            document.getElementById("deployValue").style.visibility = "visible";


        }

        let cost;
        let deployedValue;
        const calculateDeployValue = async() => {

            quant = document.getElementById("deployQuant").value;
            price = document.getElementById("deployPrice").value;

            cost = quant*price;
            deployedValue = cost * 2;

            var text = `Total cost is ${cost} wei`;
            var text2 = `Total deposit value is ${deployedValue} wei`;

            outputText("cost",text)
            outputText("deployValueText",text2);

        }

        async function pushSellerContract(sellerAddress, contractAddress) {

            const sellerContract = new Parse.Object("sellerContract");

            sellerContract.set("sellerAddress", sellerAddress);
            sellerContract.set("contractAddress", contractAddress);

            try {
                let result = await sellerContract.save();

            } catch (error) {
                alert(`Error: ${error.message}`);

            }
        } 
    

        let contractAddress;
        const deployContract = async () => {

            value = deployedValue;
            console.log(value);

            var text = "Please follow through the Metamask page ";
            
            outputText("contractFollowMetamaskArea", text);
            
            const ABI = [ { "inputs": [], "stateMutability": "payable", "type": "constructor" }, { "inputs": [], "name": "ActiveBuyer", "type": "error" }, { "inputs": [], "name": "AlreadyPurchased", "type": "error" }, { "inputs": [], "name": "ContractTerminated", "type": "error" }, { "inputs": [], "name": "ExceedMaxQuantity", "type": "error" }, { "inputs": [], "name": "InvalidAddress", "type": "error" }, { "inputs": [], "name": "InvalidState", "type": "error" }, { "inputs": [], "name": "ItemAddedAlready", "type": "error" }, { "inputs": [], "name": "ItemNotAdded", "type": "error" }, { "inputs": [], "name": "OnlyBuyer", "type": "error" }, { "inputs": [], "name": "OnlySeller", "type": "error" }, { "inputs": [], "name": "ValueNotEven", "type": "error" }, { "inputs": [], "name": "notEnoughEscrow", "type": "error" }, { "anonymous": false, "inputs": [], "name": "Added_item", "type": "event" }, { "anonymous": false, "inputs": [], "name": "ConfirmShipped", "type": "event" }, { "anonymous": false, "inputs": [], "name": "ItemReceived", "type": "event" }, { "anonymous": false, "inputs": [], "name": "PurchaseConfirmed", "type": "event" }, { "anonymous": false, "inputs": [], "name": "SellerRefunded", "type": "event" }, { "anonymous": false, "inputs": [], "name": "addedEscrow", "type": "event" }, { "anonymous": false, "inputs": [], "name": "closedContract", "type": "event" }, { "inputs": [ { "internalType": "uint256", "name": "quant", "type": "uint256" } ], "name": "addEscrow", "outputs": [], "stateMutability": "payable", "type": "function" }, { "inputs": [ { "internalType": "uint256", "name": "inp_value", "type": "uint256" }, { "internalType": "uint256", "name": "inp_quant", "type": "uint256" }, { "internalType": "string", "name": "inp_item_name", "type": "string" }, { "internalType": "string", "name": "inp_item_details", "type": "string" }, { "internalType": "string", "name": "inp_item_descriptions", "type": "string" } ], "name": "add_item", "outputs": [], "stateMutability": "nonpayable", "type": "function" }, { "inputs": [], "name": "checkNoActiveBuyers", "outputs": [ { "internalType": "bool", "name": "", "type": "bool" } ], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "closeContract", "outputs": [], "stateMutability": "payable", "type": "function" }, { "inputs": [ { "internalType": "uint256", "name": "quant", "type": "uint256" } ], "name": "confirmPurchase", "outputs": [], "stateMutability": "payable", "type": "function" }, { "inputs": [], "name": "confirmReceived", "outputs": [], "stateMutability": "nonpayable", "type": "function" }, { "inputs": [ { "internalType": "address", "name": "address_", "type": "address" } ], "name": "confirmShipped", "outputs": [], "stateMutability": "payable", "type": "function" }, { "inputs": [ { "internalType": "address", "name": "key", "type": "address" } ], "name": "doesExist", "outputs": [ { "internalType": "bool", "name": "", "type": "bool" } ], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "getAddress", "outputs": [ { "internalType": "address", "name": "", "type": "address" } ], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "getBalance", "outputs": [ { "internalType": "uint256", "name": "", "type": "uint256" } ], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "getBuyerNumber", "outputs": [ { "internalType": "uint256", "name": "", "type": "uint256" } ], "stateMutability": "view", "type": "function" }, { "inputs": [ { "internalType": "address", "name": "addr", "type": "address" } ], "name": "getBuyerQuantity", "outputs": [ { "internalType": "uint256", "name": "", "type": "uint256" } ], "stateMutability": "view", "type": "function" }, { "inputs": [ { "internalType": "address", "name": "addr", "type": "address" } ], "name": "getBuyerState", "outputs": [ { "internalType": "string", "name": "", "type": "string" } ], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "getEscrowLeft", "outputs": [ { "internalType": "uint256", "name": "", "type": "uint256" } ], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "getItemDescription", "outputs": [ { "internalType": "string", "name": "", "type": "string" } ], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "getItemDetails", "outputs": [ { "internalType": "string", "name": "", "type": "string" } ], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "getItemName", "outputs": [ { "internalType": "string", "name": "", "type": "string" } ], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "getItemPriceInWEI", "outputs": [ { "internalType": "string", "name": "", "type": "string" } ], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "getQuantity", "outputs": [ { "internalType": "uint256", "name": "", "type": "uint256" } ], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "getTotalBuyer", "outputs": [ { "internalType": "uint256", "name": "", "type": "uint256" } ], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "getValue", "outputs": [ { "internalType": "uint256", "name": "", "type": "uint256" } ], "stateMutability": "view", "type": "function" }, { "inputs": [ { "internalType": "address", "name": "item_received_buyer", "type": "address" } ], "name": "refundSeller", "outputs": [], "stateMutability": "nonpayable", "type": "function" } ];


            const sellerAddress = account;
            var code = "0x6080604052600060025560006004556000600960006101000a81548160ff0219169083151502179055506000600960016101000a81548160ff02191690831515021790555033600960026101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055503460018190555061295b8061009b6000396000f3fe6080604052600436106101355760003560e01c8063610be654116100ab578063a0e9ec291161006f578063a0e9ec29146103b9578063b905ebaa146103e4578063c819d85a14610421578063ddfab6a31461044c578063f7fb44cd14610475578063fd52c63f146104a057610135565b8063610be6541461032857806361b53cdc1461033257806362a759071461035b57806373fac6f0146103775780637c81d1231461038e57610135565b806320c3839f116100fd57806320c3839f146102115780633341dfe61461024e57806338cc48311461028b57806339e87889146102b6578063408b9945146102e15780634d24e9021461030c57610135565b80630115949c1461013a57806312065fe01461016557806313b53c57146101905780631a5c0730146101bb57806320965255146101e6575b600080fd5b34801561014657600080fd5b5061014f6104bc565b60405161015c9190611f2b565b60405180910390f35b34801561017157600080fd5b5061017a6104c6565b6040516101879190611f2b565b60405180910390f35b34801561019c57600080fd5b506101a56104ce565b6040516101b29190611f2b565b60405180910390f35b3480156101c757600080fd5b506101d06104d8565b6040516101dd9190611f61565b60405180910390f35b3480156101f257600080fd5b506101fb6104f5565b6040516102089190611f2b565b60405180910390f35b34801561021d57600080fd5b5061023860048036038101906102339190611fee565b6104fe565b6040516102459190611f2b565b60405180910390f35b34801561025a57600080fd5b5061027560048036038101906102709190611fee565b61058b565b6040516102829190611f61565b60405180910390f35b34801561029757600080fd5b506102a0610635565b6040516102ad919061202a565b60405180910390f35b3480156102c257600080fd5b506102cb61063d565b6040516102d891906120d5565b60405180910390f35b3480156102ed57600080fd5b506102f66106cf565b6040516103039190611f2b565b60405180910390f35b61032660048036038101906103219190612123565b6106d9565b005b610330610a9d565b005b34801561033e57600080fd5b5061035960048036038101906103549190611fee565b610c14565b005b61037560048036038101906103709190611fee565b610f0f565b005b34801561038357600080fd5b5061038c6110e1565b005b34801561039a57600080fd5b506103a3611348565b6040516103b091906120d5565b60405180910390f35b3480156103c557600080fd5b506103ce6113da565b6040516103db91906120d5565b60405180910390f35b3480156103f057600080fd5b5061040b60048036038101906104069190611fee565b61146c565b60405161041891906120d5565b60405180910390f35b34801561042d57600080fd5b50610436611659565b60405161044391906120d5565b60405180910390f35b34801561045857600080fd5b50610473600480360381019061046e9190612285565b6116eb565b005b34801561048157600080fd5b5061048a611873565b6040516104979190611f2b565b60405180910390f35b6104ba60048036038101906104b59190612123565b61187d565b005b6000600354905090565b600047905090565b6000600454905090565b600080600090506000600254036104ee57600190505b8091505090565b60008054905090565b60008161050a8161058b565b610540576040517fe6c4247b00000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b600a60008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060010154915050919050565b60008073ffffffffffffffffffffffffffffffffffffffff16600a60008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060000160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff161461062b5760019050610630565b600090505b919050565b600030905090565b60606008805461064c90612383565b80601f016020809104026020016040519081016040528092919081815260200182805461067890612383565b80156106c55780601f1061069a576101008083540402835291602001916106c5565b820191906000526020600020905b8154815290600101906020018083116106a857829003601f168201915b5050505050905090565b6000600254905090565b600960029054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1603610760576040517f86efbb5500000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b600960019054906101000a900460ff166107a6576040517f4330c19800000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b600160005460026001546107ba9190612412565b6107c49190612412565b10156107fc576040517ffa59aa5c00000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b80600354811115610839576040517f3435702900000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b600960009054906101000a900460ff1615610880576040517f6d0d905800000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b3361088a8161058b565b156108c1576040517f3367b55400000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b8260005460026108d19190612443565b6108db9190612443565b341461091c576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610913906124f7565b60405180910390fd5b826003600082825461092e9190612517565b92505081905550600260008154809291906109489061254b565b9190505550600460008154809291906109609061254b565b919050555060405180606001604052803373ffffffffffffffffffffffffffffffffffffffff168152602001600060028111156109a05761099f612593565b5b815260200184815250600a60003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008201518160000160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555060208201518160000160146101000a81548160ff02191690836002811115610a5a57610a59612593565b5b0217905550604082015181600101559050507fd5d55c8a68912e9a110618df8d5e2e83b8d83211c57a8ddd1203df92885dc88160405160405180910390a1505050565b600960029054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614610b24576040517f85d1f72600000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b610b2c6104d8565b610b62576040517fb3bf834d00000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b6001600960006101000a81548160ff021916908315150217905550600960029054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166108fc479081150290604051600060405180830381858888f19350505050158015610be5573d6000803e3d6000fd5b507f76685d578223d8852db93c5274d5fcf6e1146fd0a64794bd61450d94e4a68db760405160405180910390a1565b600960029054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614610c9b576040517f85d1f72600000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b806002806002811115610cb157610cb0612593565b5b600a60008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060000160149054906101000a900460ff166002811115610d1357610d12612593565b5b14610d4a576040517fbaf3f0f700000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b7ffda69c32bcfdba840a167777906b173b607eb8b4d8853b97a80d26e613d858db60405160405180910390a160026000815480929190610d89906125c2565b91905055506000600a60008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600101549050600960029054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166108fc826000546003610e219190612443565b610e2b9190612443565b9081150290604051600060405180830381858888f19350505050158015610e56573d6000803e3d6000fd5b50806002600054610e679190612443565b610e719190612443565b600154610e7e9190612517565b600181905550600a60008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600080820160006101000a81549073ffffffffffffffffffffffffffffffffffffffff02191690556000820160146101000a81549060ff02191690556001820160009055505050505050565b600960029054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614610f96576040517f85d1f72600000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b806000806002811115610fac57610fab612593565b5b600a60008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060000160149054906101000a900460ff16600281111561100e5761100d612593565b5b14611045576040517fbaf3f0f700000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b7fe88a499366edd85624840c77defbb45744582b650f2424cbf1f787d8cde0af9060405160405180910390a16001600a60008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060000160146101000a81548160ff021916908360028111156110d7576110d6612593565b5b0217905550505050565b600960029054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1603611168576040517f86efbb5500000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b33600180600281111561117e5761117d612593565b5b600a60008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060000160149054906101000a900460ff1660028111156111e0576111df612593565b5b14611217576040517fbaf3f0f700000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b7fe89152acd703c9d8c7d28829d443260b411454d45394e7995815140c8cbcbcf760405160405180910390a16002600a60003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060000160146101000a81548160ff021916908360028111156112a9576112a8612593565b5b02179055503373ffffffffffffffffffffffffffffffffffffffff166108fc600a60003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600101546000546113189190612443565b9081150290604051600060405180830381858888f19350505050158015611343573d6000803e3d6000fd5b505050565b60606007805461135790612383565b80601f016020809104026020016040519081016040528092919081815260200182805461138390612383565b80156113d05780601f106113a5576101008083540402835291602001916113d0565b820191906000526020600020905b8154815290600101906020018083116113b357829003601f168201915b5050505050905090565b6060600580546113e990612383565b80601f016020809104026020016040519081016040528092919081815260200182805461141590612383565b80156114625780601f1061143757610100808354040283529160200191611462565b820191906000526020600020905b81548152906001019060200180831161144557829003601f168201915b5050505050905090565b6060816114788161058b565b6114ae576040517fe6c4247b00000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b6000600a60008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060000160149054906101000a900460ff1690506000600281111561151657611515612593565b5b81600281111561152957611528612593565b5b0361156c576040518060400160405280600481526020017f7061696400000000000000000000000000000000000000000000000000000000815250925050611653565b600160028111156115805761157f612593565b5b81600281111561159357611592612593565b5b036115d6576040518060400160405280600781526020017f7368697070656400000000000000000000000000000000000000000000000000815250925050611653565b6002808111156115e9576115e8612593565b5b8160028111156115fc576115fb612593565b5b0361163f576040518060400160405280600881526020017f7265636569766564000000000000000000000000000000000000000000000000815250925050611653565b604051806020016040528060008152509250505b50919050565b60606006805461166890612383565b80601f016020809104026020016040519081016040528092919081815260200182805461169490612383565b80156116e15780601f106116b6576101008083540402835291602001916116e1565b820191906000526020600020905b8154815290600101906020018083116116c457829003601f168201915b5050505050905090565b600960029054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614611772576040517f85d1f72600000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b600960009054906101000a900460ff16156117b9576040517f6d0d905800000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b600960019054906101000a900460ff1615611800576040517f6a0dc1aa00000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b7f2102e76fd7783eb09271c3b4224bde2fb0a69c21f25f974ad8f5f113fe71433760405160405180910390a16118368585611a53565b61183f83611b23565b61184882611bbd565b61185181611c57565b6001600960016101000a81548160ff0219169083151502179055505050505050565b6000600154905090565b600960029054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614611904576040517f85d1f72600000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b600960019054906101000a900460ff1661194a576040517f4330c19800000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b600960009054906101000a900460ff1615611991576040517f6d0d905800000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b8060005460026119a19190612443565b6119ab9190612443565b34146119ec576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016119e3906124f7565b60405180910390fd5b60008190508060036000828254611a0391906125eb565b925050819055503460016000828254611a1c91906125eb565b925050819055507f5b0ad5b6591b53a9520a0e0ca3d6293496d11bf227db2b819e7c0e0ab8500a7360405160405180910390a15050565b600960029054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614611ada576040517f85d1f72600000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b8160008190555080600381905550611af182611cf1565b604051602001611b019190612681565b60405160208183030381529060405260059081611b1e9190612853565b505050565b600960029054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614611baa576040517f85d1f72600000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b8060069081611bb99190612853565b5050565b600960029054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614611c44576040517f85d1f72600000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b8060079081611c539190612853565b5050565b600960029054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614611cde576040517f85d1f72600000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b8060089081611ced9190612853565b5050565b606060006001611d0084611dbf565b01905060008167ffffffffffffffff811115611d1f57611d1e61215a565b5b6040519080825280601f01601f191660200182016040528015611d515781602001600182028036833780820191505090505b509050600082602001820190505b600115611db4578080600190039150507f3031323334353637383961626364656600000000000000000000000000000000600a86061a8153600a8581611da857611da76123b4565b5b04945060008503611d5f575b819350505050919050565b600080600090507a184f03e93ff9f4daa797ed6e38ed64bf6a1f0100000000000000008310611e1d577a184f03e93ff9f4daa797ed6e38ed64bf6a1f0100000000000000008381611e1357611e126123b4565b5b0492506040810190505b6d04ee2d6d415b85acef81000000008310611e5a576d04ee2d6d415b85acef81000000008381611e5057611e4f6123b4565b5b0492506020810190505b662386f26fc100008310611e8957662386f26fc100008381611e7f57611e7e6123b4565b5b0492506010810190505b6305f5e1008310611eb2576305f5e1008381611ea857611ea76123b4565b5b0492506008810190505b6127108310611ed7576127108381611ecd57611ecc6123b4565b5b0492506004810190505b60648310611efa5760648381611ef057611eef6123b4565b5b0492506002810190505b600a8310611f09576001810190505b80915050919050565b6000819050919050565b611f2581611f12565b82525050565b6000602082019050611f406000830184611f1c565b92915050565b60008115159050919050565b611f5b81611f46565b82525050565b6000602082019050611f766000830184611f52565b92915050565b6000604051905090565b600080fd5b600080fd5b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b6000611fbb82611f90565b9050919050565b611fcb81611fb0565b8114611fd657600080fd5b50565b600081359050611fe881611fc2565b92915050565b60006020828403121561200457612003611f86565b5b600061201284828501611fd9565b91505092915050565b61202481611fb0565b82525050565b600060208201905061203f600083018461201b565b92915050565b600081519050919050565b600082825260208201905092915050565b60005b8381101561207f578082015181840152602081019050612064565b60008484015250505050565b6000601f19601f8301169050919050565b60006120a782612045565b6120b18185612050565b93506120c1818560208601612061565b6120ca8161208b565b840191505092915050565b600060208201905081810360008301526120ef818461209c565b905092915050565b61210081611f12565b811461210b57600080fd5b50565b60008135905061211d816120f7565b92915050565b60006020828403121561213957612138611f86565b5b60006121478482850161210e565b91505092915050565b600080fd5b600080fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052604160045260246000fd5b6121928261208b565b810181811067ffffffffffffffff821117156121b1576121b061215a565b5b80604052505050565b60006121c4611f7c565b90506121d08282612189565b919050565b600067ffffffffffffffff8211156121f0576121ef61215a565b5b6121f98261208b565b9050602081019050919050565b82818337600083830152505050565b6000612228612223846121d5565b6121ba565b90508281526020810184848401111561224457612243612155565b5b61224f848285612206565b509392505050565b600082601f83011261226c5761226b612150565b5b813561227c848260208601612215565b91505092915050565b600080600080600060a086880312156122a1576122a0611f86565b5b60006122af8882890161210e565b95505060206122c08882890161210e565b945050604086013567ffffffffffffffff8111156122e1576122e0611f8b565b5b6122ed88828901612257565b935050606086013567ffffffffffffffff81111561230e5761230d611f8b565b5b61231a88828901612257565b925050608086013567ffffffffffffffff81111561233b5761233a611f8b565b5b61234788828901612257565b9150509295509295909350565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602260045260246000fd5b6000600282049050600182168061239b57607f821691505b6020821081036123ae576123ad612354565b5b50919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601260045260246000fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601160045260246000fd5b600061241d82611f12565b915061242883611f12565b925082612438576124376123b4565b5b828204905092915050565b600061244e82611f12565b915061245983611f12565b925082820261246781611f12565b9150828204841483151761247e5761247d6123e3565b5b5092915050565b7f506c656173652073656e6420696e20327820746865207075726368617365206160008201527f6d6f756e74000000000000000000000000000000000000000000000000000000602082015250565b60006124e1602583612050565b91506124ec82612485565b604082019050919050565b60006020820190508181036000830152612510816124d4565b9050919050565b600061252282611f12565b915061252d83611f12565b9250828203905081811115612545576125446123e3565b5b92915050565b600061255682611f12565b91507fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff8203612588576125876123e3565b5b600182019050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602160045260246000fd5b60006125cd82611f12565b9150600082036125e0576125df6123e3565b5b600182039050919050565b60006125f682611f12565b915061260183611f12565b9250828201905080821115612619576126186123e3565b5b92915050565b600081905092915050565b600061263582612045565b61263f818561261f565b935061264f818560208601612061565b80840191505092915050565b7f2057656900000000000000000000000000000000000000000000000000000000815250565b600061268d828461262a565b91506126988261265b565b60048201915081905092915050565b60008190508160005260206000209050919050565b60006020601f8301049050919050565b600082821b905092915050565b6000600883026127097fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff826126cc565b61271386836126cc565b95508019841693508086168417925050509392505050565b6000819050919050565b600061275061274b61274684611f12565b61272b565b611f12565b9050919050565b6000819050919050565b61276a83612735565b61277e61277682612757565b8484546126d9565b825550505050565b600090565b612793612786565b61279e818484612761565b505050565b5b818110156127c2576127b760008261278b565b6001810190506127a4565b5050565b601f821115612807576127d8816126a7565b6127e1846126bc565b810160208510156127f0578190505b6128046127fc856126bc565b8301826127a3565b50505b505050565b600082821c905092915050565b600061282a6000198460080261280c565b1980831691505092915050565b60006128438383612819565b9150826002028217905092915050565b61285c82612045565b67ffffffffffffffff8111156128755761287461215a565b5b61287f8254612383565b61288a8282856127c6565b600060209050601f8311600181146128bd57600084156128ab578287015190505b6128b58582612837565b86555061291d565b601f1984166128cb866126a7565b60005b828110156128f3578489015182556001820191506020850194506020810190506128ce565b86831015612910578489015161290c601f891682612819565b8355505b6001600288020188555050505b50505050505056fea2646970667358221220648edf27ed5fba794cc5d647ee07a35081b0a58de860b885f6049fae6aed7b5364736f6c63430008110033";

            /*const Address = "0x182cc93685355256d9c782dcd8d5e5b43016277c";
            window.web3 = await new Web3(window.ethereum);
            window.contract = await new window.web3.eth.Contract(ABI, Address); */
            

            window.web3 = await new Web3(window.ethereum);
            

            window.web3.eth.sendTransaction({
                from: account,
                data: code,
                value: value
            }).on('transactionHash', async function (hash) {
                text = "Contract is now deploying, please wait";
                outputText("contractStartsDeployingArea", text);
                
                await move();

            }).on("receipt", async function (receipt) {
                if (receipt.status == false) {
                    text = "Contract-deploy fails, please check your Metamask page for more details";
                    outputText("contractDeployStateArea", text);
                } else {


                    await move_finish();

                    text = "Contract-deploy successful!";
                    outputText("contractDeployStateArea", text);

                    contractAddress = receipt.contractAddress;

                    text = "Here is your unique contract address: " + contractAddress;
                    outputText("contractAddressArea", text);

                    // store the contract address to the database
                    pushSellerContract(account, contractAddress); 
                    
                    // store the contract address and seller address to local storage and ensure the next page can access them
                    localStorage.setItem('contractAddress', contractAddress);
                    localStorage.setItem('sellerAddress', account);
                    localStorage.setItem('itemQuantity', quant);
                    localStorage.setItem('itemPrice', price);

                    console.log(localStorage.getItem("itemPrice"));
                    console.log(localStorage.getItem("itemQuantity"));


                    var button = document.getElementById("addItem");
                    button.style.visibility = "visible";
                    
                }
                
            });
            
            /* funtion of the moving bar */
            async function move() {
                var text = document.getElementById("myProgress");
                var elem = document.getElementById("myBar");
                text.style.opacity = 1.0;
                elem.style.opacity = 1.0;
                
                i = 1;
                var width = 10;
                var id = setInterval(frame, 10);
                function frame() {
                if (width >= 90) {
                    clearInterval(id);
                    i = 0;
                } else {
                    width = width + 0.07;
                    elem.style.width = width + "%";
                    elem.innerHTML = Number((width).toFixed(1))  + "%";
                    }   
                }
                
            }
            
            async function move_finish() {
                var text = document.getElementById("myProgress");
                var elem = document.getElementById("myBar");
                text.style.opacity = 1.0;
                elem.style.opacity = 1.0;
                
                i = 1;
                var width = 90;
                var id = setInterval(frame, 10);
                function frame() {
                if (width >= 100) {
                    clearInterval(id);
                    i = 0;
                } else {
                    width = width + 0.08;
                    if (width > 100) {
                        width = 100;
                        elem.style.width = width + "%";
                        elem.innerHTML = Number((width).toFixed(1))  + "%";
                    } else {
                        elem.style.width = width + "%";
                        elem.innerHTML = Number((width).toFixed(1))  + "%";
                    }
                }
                
            }
            
            async function pushSellerContract(sellerAddress, contractAddress) {

                const sellerContract = new Parse.Object("sellerContract");
   
                sellerContract.set("sellerAddress", sellerAddress);
                sellerContract.set("contractAddress", contractAddress);

                try {
                    let result = await sellerContract.save();

                } catch (error) {
                    alert(`Error: ${error.message}`);

                }
            } 
            
        }
    }

        

    </script>
     <!-- JS
============================================ -->
    <!-- Modernizer JS -->
    <script src="assets/js/vendor/modernizr.min.js"></script>
    <!-- jQuery JS -->
    <script src="assets/js/vendor/jquery.js"></script>
    <!-- Bootstrap JS -->
    <script src="assets/js/vendor/popper.min.js"></script>
    <script src="assets/js/vendor/bootstrap.min.js"></script>
    <script src="assets/js/vendor/slick.min.js"></script>
    <script src="assets/js/vendor/js.cookie.js"></script>
    <script src="assets/js/vendor/jquery-ui.min.js"></script>
    <script src="assets/js/vendor/jquery.countdown.min.js"></script>
    <script src="assets/js/vendor/sal.js"></script>
    <script src="assets/js/vendor/jquery.magnific-popup.min.js"></script>
    <script src="assets/js/vendor/imagesloaded.pkgd.min.js"></script>
    <script src="assets/js/vendor/isotope.pkgd.min.js"></script>
    <script src="assets/js/vendor/counterup.js"></script>
    <script src="assets/js/vendor/waypoints.min.js"></script>

    <!-- Main JS -->
    <script src="assets/js/main.js"></script>

</body>

</html>