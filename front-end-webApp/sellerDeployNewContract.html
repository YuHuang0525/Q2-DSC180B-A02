<!DOCTYPE html>
<html>

<head>
    <script type="text/javascript" src="https://npmcdn.com/parse/dist/parse.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/web3/1.2.7-rc.0/web3.min.js"></script>
    <link href="background.css" rel="stylesheet" type="text/css">
    <style>
        
        #myProgress {
            width: 100%;
            background-color: #ddd;
            opacity: 0;
        }

        #myBar {
            width: 0%;
            height: 40px;
            background-color: #51e7ec;
            text-align: center;
            line-height: 40px;
            color: white;
            opacity: 0;
        }

        .cool-input {
            display: block;
            width: 300px;
            padding: 10px;
            margin: 0 auto;
            font-size: 16px;
            border: 2px solid #ddd;
            border-radius: 10px;
            background-color: #f5f5f5;
            color: #333;
            outline: none;
        }
        .cool-input:focus {
            border-color: #5bc0de;
            box-shadow: 0 0 5px #5bc0de;
        }

        #addItem {
            display: inline-block;
            padding: 10px 20px;
            background-color: #007bff;
            color: white;
            font-size: 16px;
            border-radius: 25px;
            border: none;
            text-align: center;
            text-decoration: none;
            overflow: hidden;
            position: relative;
            animation-name: motivate;
            animation-duration: 3s;
            animation-iteration-count: infinite;
            animation-direction: alternate;
        }
        #addItem:hover {
            cursor: pointer;
            background-color: #2cd1fa;
        }
        @keyframes motivate {
            0% {
            transform: translateY(0);
            }
            20% {
            transform: translateY(-10px);
            }
            40% {
            transform: translateY(0);
            }
            60% {
            transform: translateY(-5px);
            }
            80% {
            transform: translateY(0);
            }
            100% {
            transform: translateY(-2px);
            }
        }

        body {
            background-color: rgb(16, 17, 17);
            font-family: fantasy;
            font-size: 30px;
            display: flex;
            text-align: center;
            height: 200vh;
        }
        
        p {
            font-family: fantasy;
            font-size: 28px;
            color:  #e1ecc0;
        }

        h1 {
            text-align: center;
            font-size: 3.0rem;
            font-weight: bold;
            margin-top: 10vh;

            /* Fallback: Set a background color. */
            background-color: white;
            
            /* Create the gradient. */
            background-image: linear-gradient(100deg, #b6f50a, #0ee4e4);
            
            /* Set the background size and repeat properties. */
            background-size: 100%;
            background-repeat: repeat;

            /* Use the text as a mask for the background. */
            /* This will show the gradient as a text color rather than element bg. */
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent; 
            -moz-background-clip: text;
            -moz-text-fill-color: transparent;
            
        }

        button {
            display: inline-block;
            background-color: #007bff;
            text-align: center;
            color: #fff;
            font-size: 1.5rem;
            padding: 1rem 2.5rem;
            border-radius: 5rem;
            border: none;
            margin: 0 1rem;
            cursor: pointer;
            box-shadow: 0 0.5rem #0069e0;
            transition: all 0.3s ease;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 0.8rem #0069e0;
        }

        #readArea {
            flex-basis: 50%;
        }

        #writeArea {
            flex-basis: 50%;
        }


    </style>

</head>

<body>
    
    <h1>Deploy New Contract</h1>

    <div id="readArea">
        <br>

        <button onclick="connectMetamask()">CONNECT TO METAMASK</button> <br>
        <p id="accountArea"></p>

        <button onclick="haveMyOwnContract()">HAVE MY OWN CONTRACT</button> <br>
        <p id="contractDeployValue"></p>
        <input style="visibility: hidden;" type="text" class="cool-input" id="deployValue" placeholder="Enter the amount in Wei"> <br>
        <br>
        <button style="visibility: hidden;" id="deployContract" onclick="deployContract()">DEPLOY CONTRACT</button> <br>

        <p id="contractFollowMetamaskArea"></p>
        <p id="contractStartsDeployingArea"></p>
        <div id="myProgress">
            <div id="myBar">0%</div>
        </div>
        <p id="contractWaitingArea"></p>
        <p id="contractDeployStateArea"></p>
        <p id="contractAddressArea"></p>
        
        <p id="toContractDetail"></p>

        <button style="visibility: hidden;" id="addItem" onclick="location.href = 'sellerAddItemPage.html';">Add Item to My Contract</button>


    </div>

    <script>

        /* Ensure that the page starts at the top whenever refresh the page */
        window.onbeforeunload = function () {
            window.scrollTo(0, 0);
        }

        Parse.initialize("rgzBD2oDrFGwnP4GhepGqvLTb4zxUCVA8ISU94G6", "rbN8I2nlk462haH28HHxwAka3o02oVqWWz1PrFdi"); //PASTE HERE YOUR Back4App APPLICATION ID AND YOUR JavaScript KEY
        Parse.serverURL = "https://parseapi.back4app.com/";

        /* function that helps dynamically output text */

        function outputText(id, text) {

            var index = 0;
            var speed = 50;
            var container = document.getElementById(id);
            
            if (container.innerHTML !== "") {
                container = "";
            }

            var interval = setInterval(function() {
            if (index < text.length) {
                container.innerHTML += text.charAt(index);
                index++;
            } else {
                clearInterval(interval);
            }
            }, speed);
        }


        /* function that helps scroll down the html page*/
        function scrollToPosition(position, duration) {
        // Get the current scroll position
        var start = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop || 0;
        
        // Calculate the distance to scroll
        var distance = position - start;
        
        // Get the start time
        var startTime = null;
        
        function scroll(time) {
          if (startTime === null) {
            startTime = time;
          }
          
          var timeElapsed = time - startTime;
          var progress = Math.min(timeElapsed / duration, 1);
          var scrollTop = start + distance * easeInOutCubic(progress);
          window.scrollTo(0, scrollTop);
          
          if (timeElapsed < duration) {
            window.requestAnimationFrame(scroll);
          }
        }
        
        function easeInOutCubic(t) {
          return t < 0.5 ? 4 * t * t * t : (t - 1) * (2 * t - 2) * (2 * t - 2) + 1;
        }
        
        window.requestAnimationFrame(scroll);
        }
      
        function scrollDown() {
            var position = document.body.scrollHeight - window.innerHeight;
            var duration = 1700;
            scrollToPosition(position*0.2, duration);
        }
    


        let account;
        const connectMetamask = async () => {
            if (window.ethereum !== "undefined") {
                const accounts = await ethereum.request({ method: "eth_requestAccounts" });
                account = accounts[0];
                
                var text = `Hello Address: ${account}`;
                
                outputText("accountArea", text);

            }
            
        }

        let value = 0;
        const haveMyOwnContract = async () => {

            var text = "Please enter the amount you want to deploy to the contract below, it can be 0 for now and you can always add more balance to your contract later";

            outputText("contractDeployValue", text);
            
            scrollDown();

            document.getElementById("deployValue").style.visibility = "visible";

            document.getElementById("deployContract").style.visibility = "visible";

        }
    

        let contractAddress;
        const deployContract = async () => {

            value = document.getElementById("deployValue").value;

            var text = "Please follow through the Metamask page ";
            
            outputText("contractFollowMetamaskArea", text);
            
            const ABI = [ { "inputs": [], "stateMutability": "payable", "type": "constructor" }, { "inputs": [], "name": "InvalidState", "type": "error" }, { "inputs": [], "name": "ItemNotAdded", "type": "error" }, { "inputs": [], "name": "OnlyBuyer", "type": "error" }, { "inputs": [], "name": "OnlySeller", "type": "error" }, { "inputs": [], "name": "ValueNotEven", "type": "error" }, { "inputs": [], "name": "notEnoughEscrow", "type": "error" }, { "anonymous": false, "inputs": [], "name": "ConfirmShipped", "type": "event" }, { "anonymous": false, "inputs": [], "name": "ItemReceived", "type": "event" }, { "anonymous": false, "inputs": [], "name": "PurchaseConfirmed", "type": "event" }, { "anonymous": false, "inputs": [], "name": "SellerRefunded", "type": "event" }, { "anonymous": false, "inputs": [], "name": "addedEscrow", "type": "event" }, { "anonymous": false, "inputs": [], "name": "closedContract", "type": "event" }, { "inputs": [], "name": "addEscrow", "outputs": [], "stateMutability": "payable", "type": "function" }, { "inputs": [ { "internalType": "uint256", "name": "inp_value", "type": "uint256" }, { "internalType": "string", "name": "inp_item_name", "type": "string" }, { "internalType": "string", "name": "inp_item_details", "type": "string" }, { "internalType": "string", "name": "inp_item_descriptions", "type": "string" } ], "name": "add_item", "outputs": [], "stateMutability": "nonpayable", "type": "function" }, { "inputs": [], "name": "buyerNumber", "outputs": [ { "internalType": "uint256", "name": "", "type": "uint256" } ], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "checkNoActiveBuyers", "outputs": [ { "internalType": "bool", "name": "", "type": "bool" } ], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "closeContract", "outputs": [], "stateMutability": "payable", "type": "function" }, { "inputs": [], "name": "confirmPurchase", "outputs": [], "stateMutability": "payable", "type": "function" }, { "inputs": [], "name": "confirmReceived", "outputs": [], "stateMutability": "nonpayable", "type": "function" }, { "inputs": [ { "internalType": "address", "name": "address_", "type": "address" } ], "name": "confirmShipped", "outputs": [], "stateMutability": "payable", "type": "function" }, { "inputs": [], "name": "createBuyer", "outputs": [], "stateMutability": "nonpayable", "type": "function" }, { "inputs": [ { "internalType": "address", "name": "key", "type": "address" } ], "name": "doesExist", "outputs": [ { "internalType": "bool", "name": "", "type": "bool" } ], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "escrowLeft", "outputs": [ { "internalType": "uint256", "name": "", "type": "uint256" } ], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "getAddress", "outputs": [ { "internalType": "address", "name": "", "type": "address" } ], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "getBalance", "outputs": [ { "internalType": "uint256", "name": "", "type": "uint256" } ], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "getBuyerNumber", "outputs": [ { "internalType": "uint256", "name": "", "type": "uint256" } ], "stateMutability": "view", "type": "function" }, { "inputs": [ { "internalType": "address", "name": "addr", "type": "address" } ], "name": "getBuyerState", "outputs": [ { "internalType": "string", "name": "", "type": "string" } ], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "getItemDescription", "outputs": [ { "internalType": "string", "name": "", "type": "string" } ], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "getItemDetails", "outputs": [ { "internalType": "string", "name": "", "type": "string" } ], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "getItemName", "outputs": [ { "internalType": "string", "name": "", "type": "string" } ], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "getItemPriceInWEI", "outputs": [ { "internalType": "string", "name": "", "type": "string" } ], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "getValue", "outputs": [ { "internalType": "uint256", "name": "", "type": "uint256" } ], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "quantity", "outputs": [ { "internalType": "uint256", "name": "", "type": "uint256" } ], "stateMutability": "view", "type": "function" }, { "inputs": [ { "internalType": "address", "name": "item_received_buyer", "type": "address" } ], "name": "refundSeller", "outputs": [], "stateMutability": "nonpayable", "type": "function" }, { "inputs": [], "name": "seller", "outputs": [ { "internalType": "address payable", "name": "", "type": "address" } ], "stateMutability": "view", "type": "function" }, { "inputs": [ { "internalType": "string", "name": "inp_item_descriptions", "type": "string" } ], "name": "setItem_Descriptions", "outputs": [], "stateMutability": "nonpayable", "type": "function" }, { "inputs": [ { "internalType": "string", "name": "inp_item_details", "type": "string" } ], "name": "setItem_Details", "outputs": [], "stateMutability": "nonpayable", "type": "function" }, { "inputs": [ { "internalType": "string", "name": "inp_item_name", "type": "string" } ], "name": "setItem_Name", "outputs": [], "stateMutability": "nonpayable", "type": "function" }, { "inputs": [ { "internalType": "uint256", "name": "inp_value", "type": "uint256" } ], "name": "setValue_Quant", "outputs": [], "stateMutability": "nonpayable", "type": "function" }, { "inputs": [], "name": "value", "outputs": [ { "internalType": "uint256", "name": "", "type": "uint256" } ], "stateMutability": "view", "type": "function" } ];

            const sellerAddress = account;
            var code = "0x6080604052600060025560026004556000600960006101000a81548160ff0219169083151502179055506000600960016101000a81548160ff02191690831515021790555033600960026101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555034600181905550612a408061009b6000396000f3fe6080604052600436106101b75760003560e01c80634c0b2db1116100ec578063977b49061161008a578063bd4e219411610064578063bd4e219414610563578063c819d85a1461058e578063d6960697146105b9578063e3806029146105c3576101b7565b8063977b4906146104d2578063a0e9ec29146104fb578063b905ebaa14610526576101b7565b806362a75907116100c657806362a759071461046a578063708ddcf31461048657806373fac6f0146104905780637c81d123146104a7576101b7565b80634c0b2db114610420578063610be6541461043757806361b53cdc14610441576101b7565b80632096525511610159578063397feb8611610133578063397feb861461037657806339e878891461039f5780633fa4f245146103ca578063408b9945146103f5576101b7565b806320965255146102e35780633341dfe61461030e57806338cc48311461034b576101b7565b806312065fe01161019557806312065fe01461023957806312bd30711461026457806317fc45e21461028d5780631a5c0730146102b8576101b7565b8063033c5768146101bc57806308551a53146101e55780630eb2acba14610210575b600080fd5b3480156101c857600080fd5b506101e360048036038101906101de9190612143565b6105ee565b005b3480156101f157600080fd5b506101fa610688565b60405161020791906121cd565b60405180910390f35b34801561021c57600080fd5b506102376004803603810190610232919061221e565b6106ae565b005b34801561024557600080fd5b5061024e610798565b60405161025b919061225a565b60405180910390f35b34801561027057600080fd5b5061028b60048036038101906102869190612143565b6107a0565b005b34801561029957600080fd5b506102a261083a565b6040516102af919061225a565b60405180910390f35b3480156102c457600080fd5b506102cd610840565b6040516102da9190612290565b60405180910390f35b3480156102ef57600080fd5b506102f86109bc565b604051610305919061225a565b60405180910390f35b34801561031a57600080fd5b50610335600480360381019061033091906122e9565b6109c5565b6040516103429190612290565b60405180910390f35b34801561035757600080fd5b50610360610a6f565b60405161036d9190612325565b60405180910390f35b34801561038257600080fd5b5061039d60048036038101906103989190612143565b610a77565b005b3480156103ab57600080fd5b506103b4610b11565b6040516103c191906123bf565b60405180910390f35b3480156103d657600080fd5b506103df610ba3565b6040516103ec919061225a565b60405180910390f35b34801561040157600080fd5b5061040a610ba9565b604051610417919061225a565b60405180910390f35b34801561042c57600080fd5b50610435610bb3565b005b61043f610e8d565b005b34801561044d57600080fd5b50610468600480360381019061046391906122e9565b610fd9565b005b610484600480360381019061047f91906122e9565b61126e565b005b61048e611454565b005b34801561049c57600080fd5b506104a5611576565b005b3480156104b357600080fd5b506104bc611790565b6040516104c991906123bf565b60405180910390f35b3480156104de57600080fd5b506104f960048036038101906104f491906123e1565b611822565b005b34801561050757600080fd5b506105106118ee565b60405161051d91906123bf565b60405180910390f35b34801561053257600080fd5b5061054d600480360381019061054891906122e9565b611980565b60405161055a91906123bf565b60405180910390f35b34801561056f57600080fd5b50610578611baa565b604051610585919061225a565b60405180910390f35b34801561059a57600080fd5b506105a3611bb0565b6040516105b091906123bf565b60405180910390f35b6105c1611c42565b005b3480156105cf57600080fd5b506105d8611dc2565b6040516105e5919061225a565b60405180910390f35b600960029054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614610675576040517f85d1f72600000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b806006908161068491906126a8565b5050565b600960029054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b600960029054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614610735576040517f85d1f72600000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b80600081905550600260005460015461074e91906127d8565b61075891906127d8565b60038190555061076781611dc8565b604051602001610777919061286b565b6040516020818303038152906040526005908161079491906126a8565b5050565b600047905090565b600960029054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614610827576040517f85d1f72600000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b806007908161083691906126a8565b5050565b60035481565b6000806001905060005b600b805490508110156109b4576000600b828154811061086d5761086c612891565b5b9060005260206000200160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff169050600060038111156108ae576108ad6128c0565b5b600a60008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060000160149054906101000a900460ff1660038111156109105761090f6128c0565b5b14158015610991575060038081111561092c5761092b6128c0565b5b600a60008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060000160149054906101000a900460ff16600381111561098e5761098d6128c0565b5b14155b156109a05760009250506109b4565b5080806109ac906128ef565b91505061084a565b508091505090565b60008054905090565b60008073ffffffffffffffffffffffffffffffffffffffff16600a60008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060000160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1614610a655760019050610a6a565b600090505b919050565b600030905090565b600960029054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614610afe576040517f85d1f72600000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b8060089081610b0d91906126a8565b5050565b606060088054610b20906124cb565b80601f0160208091040260200160405190810160405280929190818152602001828054610b4c906124cb565b8015610b995780601f10610b6e57610100808354040283529160200191610b99565b820191906000526020600020905b815481529060010190602001808311610b7c57829003601f168201915b5050505050905090565b60005481565b6000600254905090565b600960029054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1603610c3a576040517f86efbb5500000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b600960019054906101000a900460ff16610c80576040517f4330c19800000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b6002546000546002600154610c9591906127d8565b610c9f91906127d8565b11610cd6576040517ffa59aa5c00000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b610cdf336109c5565b1580610cea57600080fd5b6004546002541080610cfb57600080fd5b600960009054906101000a900460ff161580610d1657600080fd5b60026000815480929190610d29906128ef565b919050555060405180604001604052803373ffffffffffffffffffffffffffffffffffffffff16815260200160006003811115610d6957610d686128c0565b5b815250600a60003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008201518160000160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555060208201518160000160146101000a81548160ff02191690836003811115610e1d57610e1c6128c0565b5b0217905550905050600b339080600181540180825580915050600190039060005260206000200160009091909190916101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550505050565b600960029054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614610f14576040517f85d1f72600000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b610f1c610840565b80610f2657600080fd5b6001600960006101000a81548160ff021916908315150217905550600960029054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166108fc479081150290604051600060405180830381858888f19350505050158015610fa9573d6000803e3d6000fd5b507f76685d578223d8852db93c5274d5fcf6e1146fd0a64794bd61450d94e4a68db760405160405180910390a150565b600960029054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614611060576040517f85d1f72600000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b806003806003811115611076576110756128c0565b5b600a60008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060000160149054906101000a900460ff1660038111156110d8576110d76128c0565b5b1461110f576040517fbaf3f0f700000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b7ffda69c32bcfdba840a167777906b173b607eb8b4d8853b97a80d26e613d858db60405160405180910390a1600a60008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600080820160006101000a81549073ffffffffffffffffffffffffffffffffffffffff02191690556000820160146101000a81549060ff02191690555050600260008154809291906111cb90612937565b9190505550600960029054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166108fc600054600361121b9190612960565b9081150290604051600060405180830381858888f19350505050158015611246573d6000803e3d6000fd5b5060026000546112569190612960565b60015461126391906129a2565b600181905550505050565b600960029054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16146112f5576040517f85d1f72600000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b80600180600381111561130b5761130a6128c0565b5b600a60008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060000160149054906101000a900460ff16600381111561136d5761136c6128c0565b5b146113a4576040517fbaf3f0f700000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b6113ad836109c5565b806113b757600080fd5b7fe88a499366edd85624840c77defbb45744582b650f2424cbf1f787d8cde0af9060405160405180910390a16002600a60008673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060000160146101000a81548160ff02191690836003811115611449576114486128c0565b5b021790555050505050565b600960029054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16146114db576040517f85d1f72600000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b60005460026114ea9190612960565b341015806114f757600080fd5b6000805460023461150891906127d8565b61151291906127d8565b9050806003600082825461152691906129d6565b92505081905550346001600082825461153f91906129d6565b925050819055507f5b0ad5b6591b53a9520a0e0ca3d6293496d11bf227db2b819e7c0e0ab8500a7360405160405180910390a15050565b600960029054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16036115fd576040517f86efbb5500000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b336002806003811115611613576116126128c0565b5b600a60008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060000160149054906101000a900460ff166003811115611675576116746128c0565b5b146116ac576040517fbaf3f0f700000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b7fe89152acd703c9d8c7d28829d443260b411454d45394e7995815140c8cbcbcf760405160405180910390a16003600a60003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060000160146101000a81548160ff0219169083600381111561173e5761173d6128c0565b5b02179055503373ffffffffffffffffffffffffffffffffffffffff166108fc6000549081150290604051600060405180830381858888f1935050505015801561178b573d6000803e3d6000fd5b505050565b60606007805461179f906124cb565b80601f01602080910402602001604051908101604052809291908181526020018280546117cb906124cb565b80156118185780601f106117ed57610100808354040283529160200191611818565b820191906000526020600020905b8154815290600101906020018083116117fb57829003601f168201915b5050505050905090565b600960029054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16146118a9576040517f85d1f72600000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b6118b2846106ae565b6118bb836105ee565b6118c4826107a0565b6118cd81610a77565b6001600960016101000a81548160ff02191690831515021790555050505050565b6060600580546118fd906124cb565b80601f0160208091040260200160405190810160405280929190818152602001828054611929906124cb565b80156119765780601f1061194b57610100808354040283529160200191611976565b820191906000526020600020905b81548152906001019060200180831161195957829003601f168201915b5050505050905090565b606061198b826109c5565b8061199557600080fd5b6000600a60008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060000160149054906101000a900460ff169050600060038111156119fd576119fc6128c0565b5b816003811115611a1057611a0f6128c0565b5b03611a53576040518060400160405280600781526020017f6372656174656400000000000000000000000000000000000000000000000000815250925050611ba4565b60016003811115611a6757611a666128c0565b5b816003811115611a7a57611a796128c0565b5b03611abd576040518060400160405280600481526020017f7061696400000000000000000000000000000000000000000000000000000000815250925050611ba4565b60026003811115611ad157611ad06128c0565b5b816003811115611ae457611ae36128c0565b5b03611b27576040518060400160405280600781526020017f7368697070656400000000000000000000000000000000000000000000000000815250925050611ba4565b600380811115611b3a57611b396128c0565b5b816003811115611b4d57611b4c6128c0565b5b03611b90576040518060400160405280600881526020017f7265636569766564000000000000000000000000000000000000000000000000815250925050611ba4565b604051806020016040528060008152509250505b50919050565b60025481565b606060068054611bbf906124cb565b80601f0160208091040260200160405190810160405280929190818152602001828054611beb906124cb565b8015611c385780601f10611c0d57610100808354040283529160200191611c38565b820191906000526020600020905b815481529060010190602001808311611c1b57829003601f168201915b5050505050905090565b336000806003811115611c5857611c576128c0565b5b600a60008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060000160149054906101000a900460ff166003811115611cba57611cb96128c0565b5b14611cf1576040517fbaf3f0f700000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b6000546002611d009190612960565b341480611d0c57600080fd5b600160036000828254611d1f91906129a2565b925050819055507fd5d55c8a68912e9a110618df8d5e2e83b8d83211c57a8ddd1203df92885dc88160405160405180910390a16001600a60003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060000160146101000a81548160ff02191690836003811115611db857611db76128c0565b5b0217905550505050565b60015481565b606060006001611dd784611e96565b01905060008167ffffffffffffffff811115611df657611df5612018565b5b6040519080825280601f01601f191660200182016040528015611e285781602001600182028036833780820191505090505b509050600082602001820190505b600115611e8b578080600190039150507f3031323334353637383961626364656600000000000000000000000000000000600a86061a8153600a8581611e7f57611e7e61277a565b5b04945060008503611e36575b819350505050919050565b600080600090507a184f03e93ff9f4daa797ed6e38ed64bf6a1f0100000000000000008310611ef4577a184f03e93ff9f4daa797ed6e38ed64bf6a1f0100000000000000008381611eea57611ee961277a565b5b0492506040810190505b6d04ee2d6d415b85acef81000000008310611f31576d04ee2d6d415b85acef81000000008381611f2757611f2661277a565b5b0492506020810190505b662386f26fc100008310611f6057662386f26fc100008381611f5657611f5561277a565b5b0492506010810190505b6305f5e1008310611f89576305f5e1008381611f7f57611f7e61277a565b5b0492506008810190505b6127108310611fae576127108381611fa457611fa361277a565b5b0492506004810190505b60648310611fd15760648381611fc757611fc661277a565b5b0492506002810190505b600a8310611fe0576001810190505b80915050919050565b6000604051905090565b600080fd5b600080fd5b600080fd5b600080fd5b6000601f19601f8301169050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052604160045260246000fd5b61205082612007565b810181811067ffffffffffffffff8211171561206f5761206e612018565b5b80604052505050565b6000612082611fe9565b905061208e8282612047565b919050565b600067ffffffffffffffff8211156120ae576120ad612018565b5b6120b782612007565b9050602081019050919050565b82818337600083830152505050565b60006120e66120e184612093565b612078565b90508281526020810184848401111561210257612101612002565b5b61210d8482856120c4565b509392505050565b600082601f83011261212a57612129611ffd565b5b813561213a8482602086016120d3565b91505092915050565b60006020828403121561215957612158611ff3565b5b600082013567ffffffffffffffff81111561217757612176611ff8565b5b61218384828501612115565b91505092915050565b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b60006121b78261218c565b9050919050565b6121c7816121ac565b82525050565b60006020820190506121e260008301846121be565b92915050565b6000819050919050565b6121fb816121e8565b811461220657600080fd5b50565b600081359050612218816121f2565b92915050565b60006020828403121561223457612233611ff3565b5b600061224284828501612209565b91505092915050565b612254816121e8565b82525050565b600060208201905061226f600083018461224b565b92915050565b60008115159050919050565b61228a81612275565b82525050565b60006020820190506122a56000830184612281565b92915050565b60006122b68261218c565b9050919050565b6122c6816122ab565b81146122d157600080fd5b50565b6000813590506122e3816122bd565b92915050565b6000602082840312156122ff576122fe611ff3565b5b600061230d848285016122d4565b91505092915050565b61231f816122ab565b82525050565b600060208201905061233a6000830184612316565b92915050565b600081519050919050565b600082825260208201905092915050565b60005b8381101561237a57808201518184015260208101905061235f565b60008484015250505050565b600061239182612340565b61239b818561234b565b93506123ab81856020860161235c565b6123b481612007565b840191505092915050565b600060208201905081810360008301526123d98184612386565b905092915050565b600080600080608085870312156123fb576123fa611ff3565b5b600061240987828801612209565b945050602085013567ffffffffffffffff81111561242a57612429611ff8565b5b61243687828801612115565b935050604085013567ffffffffffffffff81111561245757612456611ff8565b5b61246387828801612115565b925050606085013567ffffffffffffffff81111561248457612483611ff8565b5b61249087828801612115565b91505092959194509250565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602260045260246000fd5b600060028204905060018216806124e357607f821691505b6020821081036124f6576124f561249c565b5b50919050565b60008190508160005260206000209050919050565b60006020601f8301049050919050565b600082821b905092915050565b60006008830261255e7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff82612521565b6125688683612521565b95508019841693508086168417925050509392505050565b6000819050919050565b60006125a56125a061259b846121e8565b612580565b6121e8565b9050919050565b6000819050919050565b6125bf8361258a565b6125d36125cb826125ac565b84845461252e565b825550505050565b600090565b6125e86125db565b6125f38184846125b6565b505050565b5b818110156126175761260c6000826125e0565b6001810190506125f9565b5050565b601f82111561265c5761262d816124fc565b61263684612511565b81016020851015612645578190505b61265961265185612511565b8301826125f8565b50505b505050565b600082821c905092915050565b600061267f60001984600802612661565b1980831691505092915050565b6000612698838361266e565b9150826002028217905092915050565b6126b182612340565b67ffffffffffffffff8111156126ca576126c9612018565b5b6126d482546124cb565b6126df82828561261b565b600060209050601f8311600181146127125760008415612700578287015190505b61270a858261268c565b865550612772565b601f198416612720866124fc565b60005b8281101561274857848901518255600182019150602085019450602081019050612723565b868310156127655784890151612761601f89168261266e565b8355505b6001600288020188555050505b505050505050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601260045260246000fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601160045260246000fd5b60006127e3826121e8565b91506127ee836121e8565b9250826127fe576127fd61277a565b5b828204905092915050565b600081905092915050565b600061281f82612340565b6128298185612809565b935061283981856020860161235c565b80840191505092915050565b7f2057656900000000000000000000000000000000000000000000000000000000815250565b60006128778284612814565b915061288282612845565b60048201915081905092915050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052603260045260246000fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602160045260246000fd5b60006128fa826121e8565b91507fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff820361292c5761292b6127a9565b5b600182019050919050565b6000612942826121e8565b915060008203612955576129546127a9565b5b600182039050919050565b600061296b826121e8565b9150612976836121e8565b9250828202612984816121e8565b9150828204841483151761299b5761299a6127a9565b5b5092915050565b60006129ad826121e8565b91506129b8836121e8565b92508282039050818111156129d0576129cf6127a9565b5b92915050565b60006129e1826121e8565b91506129ec836121e8565b9250828201905080821115612a0457612a036127a9565b5b9291505056fea26469706673582212202d70e2d84a7085303b3581c2d549af7b5236d217036a7b419f24f4599eb31d8a64736f6c63430008110033"

            /*const Address = "0x182cc93685355256d9c782dcd8d5e5b43016277c";
            window.web3 = await new Web3(window.ethereum);
            window.contract = await new window.web3.eth.Contract(ABI, Address); */
            
            

            window.web3 = await new Web3(window.ethereum);


            window.web3.eth.sendTransaction({
                from: sellerAddress,
                data: code,
                value: value
            }).on('transactionHash', async function (hash) {
                text = "Contract is now deploying, please wait";
                outputText("contractStartsDeployingArea", text);
                
                await move();

            }).on("receipt", async function (receipt) {
                if (receipt.status == false) {
                    text = "Contract-deploy fails, please check your Metamask page for more details";
                    outputText("contractDeployStateArea", text);
                } else {


                    await move_finish();

                    text = "Contract-deploy successful!";
                    outputText("contractDeployStateArea", text);

                    contractAddress = receipt.contractAddress;

                    text = "Here is your unique contract address: " + contractAddress;
                    outputText("contractAddressArea", text);

                    // store the contract address to the database
                    pushSellerContract(sellerAddress, contractAddress); 
                    
                    // store the contract address and seller address to local storage and ensure the next page can access them
                    localStorage.setItem('contractAddress', contractAddress);
                    localStorage.setItem('sellerAddress', account);

                    var button = document.getElementById("addItem");
                    button.style.visibility = "visible";
                    
                }
                
            });
            
            /* funtion of the moving bar */
            async function move() {
                var text = document.getElementById("myProgress");
                var elem = document.getElementById("myBar");
                text.style.opacity = 1.0;
                elem.style.opacity = 1.0;
                
                i = 1;
                var width = 10;
                var id = setInterval(frame, 10);
                function frame() {
                if (width >= 90) {
                    clearInterval(id);
                    i = 0;
                } else {
                    width = width + 0.07;
                    elem.style.width = width + "%";
                    elem.innerHTML = Number((width).toFixed(1))  + "%";
                    }   
                }
                
            }
            
            async function move_finish() {
                var text = document.getElementById("myProgress");
                var elem = document.getElementById("myBar");
                text.style.opacity = 1.0;
                elem.style.opacity = 1.0;
                
                i = 1;
                var width = 90;
                var id = setInterval(frame, 10);
                function frame() {
                if (width >= 100) {
                    clearInterval(id);
                    i = 0;
                } else {
                    width = width + 0.08;
                    elem.style.width = width + "%";
                    elem.innerHTML = Number((width).toFixed(1))  + "%";
                    }   
                }
                
            }
            
            async function pushSellerContract(sellerAddress, contractAddress) {

                const sellerContract = new Parse.Object("sellerContract");
   
                sellerContract.set("sellerAddress", sellerAddress);
                sellerContract.set("contractAddress", contractAddress);

                try {
                    let result = await sellerContract.save();

                } catch (error) {
                    alert(`Error: ${error.message}`);

                }
            } 
            
        }

        

    </script>

</body>

</html>