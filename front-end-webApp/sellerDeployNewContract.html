<!DOCTYPE html>
<html>

<head>
    <script type="text/javascript" src="https://npmcdn.com/parse/dist/parse.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/web3/1.2.7-rc.0/web3.min.js"></script>
    <link href="background.css" rel="stylesheet" type="text/css">
    <style>
        
        #myProgress {
            width: 100%;
            background-color: #ddd;
            opacity: 0;
        }

        #myBar {
            width: 0%;
            height: 40px;
            background-color: #51e7ec;
            text-align: center;
            line-height: 40px;
            color: white;
            opacity: 0;
        }

        .cool-input {
            display: block;
            width: 300px;
            padding: 10px;
            margin: 0 auto;
            font-size: 16px;
            border: 2px solid #ddd;
            border-radius: 10px;
            background-color: #f5f5f5;
            color: #333;
            outline: none;
        }
        .cool-input:focus {
            border-color: #5bc0de;
            box-shadow: 0 0 5px #5bc0de;
        }

        #addItem {
            display: inline-block;
            padding: 10px 20px;
            background-color: #007bff;
            color: white;
            font-size: 16px;
            border-radius: 25px;
            border: none;
            text-align: center;
            text-decoration: none;
            overflow: hidden;
            position: relative;
            animation-name: motivate;
            animation-duration: 3s;
            animation-iteration-count: infinite;
            animation-direction: alternate;
        }
        #addItem:hover {
            cursor: pointer;
            background-color: #2cd1fa;
        }
        @keyframes motivate {
            0% {
            transform: translateY(0);
            }
            20% {
            transform: translateY(-10px);
            }
            40% {
            transform: translateY(0);
            }
            60% {
            transform: translateY(-5px);
            }
            80% {
            transform: translateY(0);
            }
            100% {
            transform: translateY(-2px);
            }
        }

        body {
            background-color: rgb(16, 17, 17);
            font-family: Arial, sans-serif;
            font-size: 30px;
            display: flex;
            text-align: center;
            height: 200vh;
        }
        
        p {
            font-family: Arial, sans-serif;
            font-size: 28px;
            color:  #f0f1ec;
        }

        h1 {
            text-align: center;
            font-size: 3.0rem;
            font-weight: bold;
            margin-top: 10vh;

            /* Fallback: Set a background color. */
            background-color: white;
            
            /* Create the gradient. */
            background-image: linear-gradient(100deg, #f2f3ed, #4a62eb);
            
            /* Set the background size and repeat properties. */
            background-size: 100%;
            background-repeat: repeat;

            /* Use the text as a mask for the background. */
            /* This will show the gradient as a text color rather than element bg. */
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent; 
            -moz-background-clip: text;
            -moz-text-fill-color: transparent;
            
        }

        

        button {
            display: inline-block;
            background-color: #007bff;
            text-align: center;
            color: #fff;
            font-size: 1.5rem;
            padding: 1rem 2.5rem;
            border-radius: 5rem;
            border: none;
            margin: 0 1rem;
            cursor: pointer;
            box-shadow: 0 0.5rem #0069e0;
            transition: all 0.3s ease;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 0.8rem #0069e0;
        }

        #readArea {
            flex-basis: 50%;
        }

        #writeArea {
            flex-basis: 50%;
        }


    </style>

</head>

<body>
    
    <h1>Deploy New Contract</h1>

    <div id="readArea">
        <br>

        <button onclick="connectMetamask()">CONNECT TO METAMASK</button> <br>
        <p id="accountArea"></p>

        <button onclick="createMyOwnContract()">CREATE MY OWN CONTRACT</button> <br>
        <p id="contractDeployValue"></p>
        <input style="visibility: hidden;" type="text" class="cool-input" id="deployValue" placeholder="Enter the amount in Wei"> <br>
        <br>
        <button style="visibility: hidden;" id="deployContract" onclick="deployContract()">DEPLOY CONTRACT</button> <br>

        <p id="contractFollowMetamaskArea"></p>
        <p id="contractStartsDeployingArea"></p>
        <div id="myProgress">
            <div id="myBar">0%</div>
        </div>
        <p id="contractWaitingArea"></p>
        <p id="contractDeployStateArea"></p>
        <p id="contractAddressArea"></p>
        
        <p id="toContractDetail"></p>

        <button style="visibility: hidden;" id="addItem" onclick="location.href = 'sellerAddItemPage.html';">Add Item to My Contract</button>


    </div>

    <script>

        /* Ensure that the page starts at the top whenever refresh the page */
        window.onbeforeunload = function () {
            window.scrollTo(0, 0);
        }

        Parse.initialize("rgzBD2oDrFGwnP4GhepGqvLTb4zxUCVA8ISU94G6", "rbN8I2nlk462haH28HHxwAka3o02oVqWWz1PrFdi"); //PASTE HERE YOUR Back4App APPLICATION ID AND YOUR JavaScript KEY
        Parse.serverURL = "https://parseapi.back4app.com/";

        /* function that helps dynamically output text */

        function outputText(id, text) {

            var index = 0;
            var speed = 50;
            var container = document.getElementById(id);
            
            if (container.innerHTML !== "") {
                container = "";
            }

            var interval = setInterval(function() {
            if (index < text.length) {
                container.innerHTML += text.charAt(index);
                index++;
            } else {
                clearInterval(interval);
            }
            }, speed);
        }


        /* function that helps scroll down the html page*/
        function scrollToPosition(position, duration) {
        // Get the current scroll position
        var start = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop || 0;
        
        // Calculate the distance to scroll
        var distance = position - start;
        
        // Get the start time
        var startTime = null;
        
        function scroll(time) {
          if (startTime === null) {
            startTime = time;
          }
          
          var timeElapsed = time - startTime;
          var progress = Math.min(timeElapsed / duration, 1);
          var scrollTop = start + distance * easeInOutCubic(progress);
          window.scrollTo(0, scrollTop);
          
          if (timeElapsed < duration) {
            window.requestAnimationFrame(scroll);
          }
        }
        
        function easeInOutCubic(t) {
          return t < 0.5 ? 4 * t * t * t : (t - 1) * (2 * t - 2) * (2 * t - 2) + 1;
        }
        
        window.requestAnimationFrame(scroll);
        }
      
        function scrollDown() {
            var position = document.body.scrollHeight - window.innerHeight;
            var duration = 1700;
            scrollToPosition(position*0.2, duration);
        }
    


        let account;
        const connectMetamask = async () => {
            if (window.ethereum !== "undefined") {
                const accounts = await ethereum.request({ method: "eth_requestAccounts" });
                account = accounts[0];
                
                var text = `Hello Address: ${account}`;
                
                outputText("accountArea", text);

            }
            
        }

        let value = 0;
        const createMyOwnContract = async () => {

            var text = "Enter the amount you want to deploy to the contract below, it can be 0 for now and you can always add more balance to your contract later";

            outputText("contractDeployValue", text);
            
            scrollDown();

            document.getElementById("deployValue").style.visibility = "visible";

            document.getElementById("deployContract").style.visibility = "visible";

        }
    

        let contractAddress;
        const deployContract = async () => {

            value = document.getElementById("deployValue").value;

            var text = "Please follow through the Metamask page ";
            
            outputText("contractFollowMetamaskArea", text);
            
            const ABI = [ { "inputs": [], "stateMutability": "payable", "type": "constructor" }, { "inputs": [], "name": "InvalidState", "type": "error" }, { "inputs": [], "name": "ItemNotAdded", "type": "error" }, { "inputs": [], "name": "OnlyBuyer", "type": "error" }, { "inputs": [], "name": "OnlySeller", "type": "error" }, { "inputs": [], "name": "ValueNotEven", "type": "error" }, { "inputs": [], "name": "notEnoughEscrow", "type": "error" }, { "anonymous": false, "inputs": [], "name": "ConfirmShipped", "type": "event" }, { "anonymous": false, "inputs": [], "name": "ItemReceived", "type": "event" }, { "anonymous": false, "inputs": [], "name": "PurchaseConfirmed", "type": "event" }, { "anonymous": false, "inputs": [], "name": "SellerRefunded", "type": "event" }, { "anonymous": false, "inputs": [], "name": "addedEscrow", "type": "event" }, { "anonymous": false, "inputs": [], "name": "closedContract", "type": "event" }, { "inputs": [], "name": "addEscrow", "outputs": [], "stateMutability": "payable", "type": "function" }, { "inputs": [ { "internalType": "uint256", "name": "inp_value", "type": "uint256" }, { "internalType": "string", "name": "inp_item_name", "type": "string" }, { "internalType": "string", "name": "inp_item_details", "type": "string" }, { "internalType": "string", "name": "inp_item_descriptions", "type": "string" } ], "name": "add_item", "outputs": [], "stateMutability": "nonpayable", "type": "function" }, { "inputs": [], "name": "buyerNumber", "outputs": [ { "internalType": "uint256", "name": "", "type": "uint256" } ], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "checkNoActiveBuyers", "outputs": [ { "internalType": "bool", "name": "", "type": "bool" } ], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "closeContract", "outputs": [], "stateMutability": "payable", "type": "function" }, { "inputs": [ { "internalType": "uint256", "name": "quant", "type": "uint256" } ], "name": "confirmPurchase", "outputs": [], "stateMutability": "payable", "type": "function" }, { "inputs": [], "name": "confirmReceived", "outputs": [], "stateMutability": "nonpayable", "type": "function" }, { "inputs": [ { "internalType": "address", "name": "address_", "type": "address" } ], "name": "confirmShipped", "outputs": [], "stateMutability": "payable", "type": "function" }, { "inputs": [], "name": "escrowLeft", "outputs": [ { "internalType": "uint256", "name": "", "type": "uint256" } ], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "getAddress", "outputs": [ { "internalType": "address", "name": "", "type": "address" } ], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "getBalance", "outputs": [ { "internalType": "uint256", "name": "", "type": "uint256" } ], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "getBuyerNumber", "outputs": [ { "internalType": "uint256", "name": "", "type": "uint256" } ], "stateMutability": "view", "type": "function" }, { "inputs": [ { "internalType": "address", "name": "addr", "type": "address" } ], "name": "getBuyerState", "outputs": [ { "internalType": "string", "name": "", "type": "string" } ], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "getItemDescription", "outputs": [ { "internalType": "string", "name": "", "type": "string" } ], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "getItemDetails", "outputs": [ { "internalType": "string", "name": "", "type": "string" } ], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "getItemName", "outputs": [ { "internalType": "string", "name": "", "type": "string" } ], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "getItemPriceInWEI", "outputs": [ { "internalType": "string", "name": "", "type": "string" } ], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "getValue", "outputs": [ { "internalType": "uint256", "name": "", "type": "uint256" } ], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "quantity", "outputs": [ { "internalType": "uint256", "name": "", "type": "uint256" } ], "stateMutability": "view", "type": "function" }, { "inputs": [ { "internalType": "address", "name": "item_received_buyer", "type": "address" } ], "name": "refundSeller", "outputs": [], "stateMutability": "nonpayable", "type": "function" }, { "inputs": [], "name": "seller", "outputs": [ { "internalType": "address payable", "name": "", "type": "address" } ], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "value", "outputs": [ { "internalType": "uint256", "name": "", "type": "uint256" } ], "stateMutability": "view", "type": "function" } ];

            const sellerAddress = account;
            var code = "0x60806040526000600255600a6004556000600960006101000a81548160ff0219169083151502179055506000600960016101000a81548160ff02191690831515021790555033600960026101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055503460018190555061267d8061009b6000396000f3fe6080604052600436106101355760003560e01c806361b53cdc116100ab578063977b49061161006f578063977b490614610374578063a0e9ec291461039d578063b905ebaa146103c8578063bd4e219414610405578063c819d85a14610430578063e38060291461045b57610135565b806361b53cdc146102e357806362a759071461030c578063708ddcf31461032857806373fac6f0146103325780637c81d1231461034957610135565b806338cc4831116100fd57806338cc48311461021157806339e878891461023c5780633fa4f24514610267578063408b9945146102925780634d24e902146102bd578063610be654146102d957610135565b806308551a531461013a57806312065fe01461016557806317fc45e2146101905780631a5c0730146101bb57806320965255146101e6575b600080fd5b34801561014657600080fd5b5061014f610486565b60405161015c9190611cb0565b60405180910390f35b34801561017157600080fd5b5061017a6104ac565b6040516101879190611ce4565b60405180910390f35b34801561019c57600080fd5b506101a56104b4565b6040516101b29190611ce4565b60405180910390f35b3480156101c757600080fd5b506101d06104ba565b6040516101dd9190611d1a565b60405180910390f35b3480156101f257600080fd5b506101fb6105b4565b6040516102089190611ce4565b60405180910390f35b34801561021d57600080fd5b506102266105bd565b6040516102339190611d56565b60405180910390f35b34801561024857600080fd5b506102516105c5565b60405161025e9190611e01565b60405180910390f35b34801561027357600080fd5b5061027c610657565b6040516102899190611ce4565b60405180910390f35b34801561029e57600080fd5b506102a761065d565b6040516102b49190611ce4565b60405180910390f35b6102d760048036038101906102d29190611e63565b610667565b005b6102e16109ba565b005b3480156102ef57600080fd5b5061030a60048036038101906103059190611ebc565b610b06565b005b61032660048036038101906103219190611ebc565b610e01565b005b610330610fd3565b005b34801561033e57600080fd5b506103476110f5565b005b34801561035557600080fd5b5061035e61135c565b60405161036b9190611e01565b60405180910390f35b34801561038057600080fd5b5061039b6004803603810190610396919061201e565b6113ee565b005b3480156103a957600080fd5b506103b26114ba565b6040516103bf9190611e01565b60405180910390f35b3480156103d457600080fd5b506103ef60048036038101906103ea9190611ebc565b61154c565b6040516103fc9190611e01565b60405180910390f35b34801561041157600080fd5b5061041a6116f8565b6040516104279190611ce4565b60405180910390f35b34801561043c57600080fd5b506104456116fe565b6040516104529190611e01565b60405180910390f35b34801561046757600080fd5b50610470611790565b60405161047d9190611ce4565b60405180910390f35b600960029054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b600047905090565b60035481565b6000806001905060005b600b805490508110156105ac576000600b82815481106104e7576104e66120d9565b5b9060005260206000200160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16905060028081111561052757610526612108565b5b600a60008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060000160149054906101000a900460ff16600281111561058957610588612108565b5b146105985760009250506105ac565b5080806105a490612166565b9150506104c4565b508091505090565b60008054905090565b600030905090565b6060600880546105d4906121dd565b80601f0160208091040260200160405190810160405280929190818152602001828054610600906121dd565b801561064d5780601f106106225761010080835404028352916020019161064d565b820191906000526020600020905b81548152906001019060200180831161063057829003601f168201915b5050505050905090565b60005481565b6000600254905090565b600960029054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16036106ee576040517f86efbb5500000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b600960019054906101000a900460ff16610734576040517f4330c19800000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b6002546000546002600154610749919061223d565b610753919061223d565b1161078a576040517ffa59aa5c00000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b6003548111158061079a57600080fd5b60045460025410806107ab57600080fd5b600960009054906101000a900460ff1615806107c657600080fd5b8360005460026107d6919061226e565b6107e0919061226e565b3414806107ec57600080fd5b84600360008282546107fe91906122b0565b925050819055506002600081548092919061081890612166565b9190505550600b339080600181540180825580915050600190039060005260206000200160009091909190916101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555060405180606001604052803373ffffffffffffffffffffffffffffffffffffffff168152602001600060028111156108bb576108ba612108565b5b815260200186815250600a60003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008201518160000160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555060208201518160000160146101000a81548160ff0219169083600281111561097557610974612108565b5b0217905550604082015181600101559050507fd5d55c8a68912e9a110618df8d5e2e83b8d83211c57a8ddd1203df92885dc88160405160405180910390a15050505050565b600960029054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614610a41576040517f85d1f72600000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b610a496104ba565b80610a5357600080fd5b6001600960006101000a81548160ff021916908315150217905550600960029054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166108fc479081150290604051600060405180830381858888f19350505050158015610ad6573d6000803e3d6000fd5b507f76685d578223d8852db93c5274d5fcf6e1146fd0a64794bd61450d94e4a68db760405160405180910390a150565b600960029054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614610b8d576040517f85d1f72600000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b806002806002811115610ba357610ba2612108565b5b600a60008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060000160149054906101000a900460ff166002811115610c0557610c04612108565b5b14610c3c576040517fbaf3f0f700000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b7ffda69c32bcfdba840a167777906b173b607eb8b4d8853b97a80d26e613d858db60405160405180910390a160026000815480929190610c7b906122e4565b91905055506000600a60008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600101549050600960029054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166108fc826000546003610d13919061226e565b610d1d919061226e565b9081150290604051600060405180830381858888f19350505050158015610d48573d6000803e3d6000fd5b50806002600054610d59919061226e565b610d63919061226e565b600154610d7091906122b0565b600181905550600a60008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600080820160006101000a81549073ffffffffffffffffffffffffffffffffffffffff02191690556000820160146101000a81549060ff02191690556001820160009055505050505050565b600960029054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614610e88576040517f85d1f72600000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b806000806002811115610e9e57610e9d612108565b5b600a60008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060000160149054906101000a900460ff166002811115610f0057610eff612108565b5b14610f37576040517fbaf3f0f700000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b7fe88a499366edd85624840c77defbb45744582b650f2424cbf1f787d8cde0af9060405160405180910390a16001600a60008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060000160146101000a81548160ff02191690836002811115610fc957610fc8612108565b5b0217905550505050565b600960029054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff161461105a576040517f85d1f72600000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b6000546002611069919061226e565b3410158061107657600080fd5b60008054600234611087919061223d565b611091919061223d565b905080600360008282546110a5919061230d565b9250508190555034600160008282546110be919061230d565b925050819055507f5b0ad5b6591b53a9520a0e0ca3d6293496d11bf227db2b819e7c0e0ab8500a7360405160405180910390a15050565b600960029054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff160361117c576040517f86efbb5500000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b33600180600281111561119257611191612108565b5b600a60008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060000160149054906101000a900460ff1660028111156111f4576111f3612108565b5b1461122b576040517fbaf3f0f700000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b7fe89152acd703c9d8c7d28829d443260b411454d45394e7995815140c8cbcbcf760405160405180910390a16002600a60003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060000160146101000a81548160ff021916908360028111156112bd576112bc612108565b5b02179055503373ffffffffffffffffffffffffffffffffffffffff166108fc600a60003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206001015460005461132c919061226e565b9081150290604051600060405180830381858888f19350505050158015611357573d6000803e3d6000fd5b505050565b60606007805461136b906121dd565b80601f0160208091040260200160405190810160405280929190818152602001828054611397906121dd565b80156113e45780601f106113b9576101008083540402835291602001916113e4565b820191906000526020600020905b8154815290600101906020018083116113c757829003601f168201915b5050505050905090565b600960029054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614611475576040517f85d1f72600000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b61147e84611796565b61148783611880565b6114908261191a565b611499816119b4565b6001600960016101000a81548160ff02191690831515021790555050505050565b6060600580546114c9906121dd565b80601f01602080910402602001604051908101604052809291908181526020018280546114f5906121dd565b80156115425780601f1061151757610100808354040283529160200191611542565b820191906000526020600020905b81548152906001019060200180831161152557829003601f168201915b5050505050905090565b60606000600a60008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060000160149054906101000a900460ff169050600060028111156115b6576115b5612108565b5b8160028111156115c9576115c8612108565b5b0361160c576040518060400160405280600481526020017f70616964000000000000000000000000000000000000000000000000000000008152509150506116f3565b600160028111156116205761161f612108565b5b81600281111561163357611632612108565b5b03611676576040518060400160405280600781526020017f73686970706564000000000000000000000000000000000000000000000000008152509150506116f3565b60028081111561168957611688612108565b5b81600281111561169c5761169b612108565b5b036116df576040518060400160405280600881526020017f72656365697665640000000000000000000000000000000000000000000000008152509150506116f3565b604051806020016040528060008152509150505b919050565b60025481565b60606006805461170d906121dd565b80601f0160208091040260200160405190810160405280929190818152602001828054611739906121dd565b80156117865780601f1061175b57610100808354040283529160200191611786565b820191906000526020600020905b81548152906001019060200180831161176957829003601f168201915b5050505050905090565b60015481565b600960029054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff161461181d576040517f85d1f72600000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b806000819055506002600054600154611836919061223d565b611840919061223d565b60038190555061184f81611a4e565b60405160200161185f91906123a3565b6040516020818303038152906040526005908161187c9190612575565b5050565b600960029054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614611907576040517f85d1f72600000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b80600690816119169190612575565b5050565b600960029054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16146119a1576040517f85d1f72600000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b80600790816119b09190612575565b5050565b600960029054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614611a3b576040517f85d1f72600000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b8060089081611a4a9190612575565b5050565b606060006001611a5d84611b1c565b01905060008167ffffffffffffffff811115611a7c57611a7b611ef3565b5b6040519080825280601f01601f191660200182016040528015611aae5781602001600182028036833780820191505090505b509050600082602001820190505b600115611b11578080600190039150507f3031323334353637383961626364656600000000000000000000000000000000600a86061a8153600a8581611b0557611b0461220e565b5b04945060008503611abc575b819350505050919050565b600080600090507a184f03e93ff9f4daa797ed6e38ed64bf6a1f0100000000000000008310611b7a577a184f03e93ff9f4daa797ed6e38ed64bf6a1f0100000000000000008381611b7057611b6f61220e565b5b0492506040810190505b6d04ee2d6d415b85acef81000000008310611bb7576d04ee2d6d415b85acef81000000008381611bad57611bac61220e565b5b0492506020810190505b662386f26fc100008310611be657662386f26fc100008381611bdc57611bdb61220e565b5b0492506010810190505b6305f5e1008310611c0f576305f5e1008381611c0557611c0461220e565b5b0492506008810190505b6127108310611c34576127108381611c2a57611c2961220e565b5b0492506004810190505b60648310611c575760648381611c4d57611c4c61220e565b5b0492506002810190505b600a8310611c66576001810190505b80915050919050565b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b6000611c9a82611c6f565b9050919050565b611caa81611c8f565b82525050565b6000602082019050611cc56000830184611ca1565b92915050565b6000819050919050565b611cde81611ccb565b82525050565b6000602082019050611cf96000830184611cd5565b92915050565b60008115159050919050565b611d1481611cff565b82525050565b6000602082019050611d2f6000830184611d0b565b92915050565b6000611d4082611c6f565b9050919050565b611d5081611d35565b82525050565b6000602082019050611d6b6000830184611d47565b92915050565b600081519050919050565b600082825260208201905092915050565b60005b83811015611dab578082015181840152602081019050611d90565b60008484015250505050565b6000601f19601f8301169050919050565b6000611dd382611d71565b611ddd8185611d7c565b9350611ded818560208601611d8d565b611df681611db7565b840191505092915050565b60006020820190508181036000830152611e1b8184611dc8565b905092915050565b6000604051905090565b600080fd5b600080fd5b611e4081611ccb565b8114611e4b57600080fd5b50565b600081359050611e5d81611e37565b92915050565b600060208284031215611e7957611e78611e2d565b5b6000611e8784828501611e4e565b91505092915050565b611e9981611d35565b8114611ea457600080fd5b50565b600081359050611eb681611e90565b92915050565b600060208284031215611ed257611ed1611e2d565b5b6000611ee084828501611ea7565b91505092915050565b600080fd5b600080fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052604160045260246000fd5b611f2b82611db7565b810181811067ffffffffffffffff82111715611f4a57611f49611ef3565b5b80604052505050565b6000611f5d611e23565b9050611f698282611f22565b919050565b600067ffffffffffffffff821115611f8957611f88611ef3565b5b611f9282611db7565b9050602081019050919050565b82818337600083830152505050565b6000611fc1611fbc84611f6e565b611f53565b905082815260208101848484011115611fdd57611fdc611eee565b5b611fe8848285611f9f565b509392505050565b600082601f83011261200557612004611ee9565b5b8135612015848260208601611fae565b91505092915050565b6000806000806080858703121561203857612037611e2d565b5b600061204687828801611e4e565b945050602085013567ffffffffffffffff81111561206757612066611e32565b5b61207387828801611ff0565b935050604085013567ffffffffffffffff81111561209457612093611e32565b5b6120a087828801611ff0565b925050606085013567ffffffffffffffff8111156120c1576120c0611e32565b5b6120cd87828801611ff0565b91505092959194509250565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052603260045260246000fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602160045260246000fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601160045260246000fd5b600061217182611ccb565b91507fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff82036121a3576121a2612137565b5b600182019050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602260045260246000fd5b600060028204905060018216806121f557607f821691505b602082108103612208576122076121ae565b5b50919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601260045260246000fd5b600061224882611ccb565b915061225383611ccb565b9250826122635761226261220e565b5b828204905092915050565b600061227982611ccb565b915061228483611ccb565b925082820261229281611ccb565b915082820484148315176122a9576122a8612137565b5b5092915050565b60006122bb82611ccb565b91506122c683611ccb565b92508282039050818111156122de576122dd612137565b5b92915050565b60006122ef82611ccb565b91506000820361230257612301612137565b5b600182039050919050565b600061231882611ccb565b915061232383611ccb565b925082820190508082111561233b5761233a612137565b5b92915050565b600081905092915050565b600061235782611d71565b6123618185612341565b9350612371818560208601611d8d565b80840191505092915050565b7f2057656900000000000000000000000000000000000000000000000000000000815250565b60006123af828461234c565b91506123ba8261237d565b60048201915081905092915050565b60008190508160005260206000209050919050565b60006020601f8301049050919050565b600082821b905092915050565b60006008830261242b7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff826123ee565b61243586836123ee565b95508019841693508086168417925050509392505050565b6000819050919050565b600061247261246d61246884611ccb565b61244d565b611ccb565b9050919050565b6000819050919050565b61248c83612457565b6124a061249882612479565b8484546123fb565b825550505050565b600090565b6124b56124a8565b6124c0818484612483565b505050565b5b818110156124e4576124d96000826124ad565b6001810190506124c6565b5050565b601f821115612529576124fa816123c9565b612503846123de565b81016020851015612512578190505b61252661251e856123de565b8301826124c5565b50505b505050565b600082821c905092915050565b600061254c6000198460080261252e565b1980831691505092915050565b6000612565838361253b565b9150826002028217905092915050565b61257e82611d71565b67ffffffffffffffff81111561259757612596611ef3565b5b6125a182546121dd565b6125ac8282856124e8565b600060209050601f8311600181146125df57600084156125cd578287015190505b6125d78582612559565b86555061263f565b601f1984166125ed866123c9565b60005b82811015612615578489015182556001820191506020850194506020810190506125f0565b86831015612632578489015161262e601f89168261253b565b8355505b6001600288020188555050505b50505050505056fea2646970667358221220aca109daca477ac84593f92b8690542eb632c42b0ce0561d861259e86cdd604164736f6c63430008110033";

            /*const Address = "0x182cc93685355256d9c782dcd8d5e5b43016277c";
            window.web3 = await new Web3(window.ethereum);
            window.contract = await new window.web3.eth.Contract(ABI, Address); */
            
            

            window.web3 = await new Web3(window.ethereum);


            window.web3.eth.sendTransaction({
                from: sellerAddress,
                data: code,
                value: value
            }).on('transactionHash', async function (hash) {
                text = "Contract is now deploying, please wait";
                outputText("contractStartsDeployingArea", text);
                
                await move();

            }).on("receipt", async function (receipt) {
                if (receipt.status == false) {
                    text = "Contract-deploy fails, please check your Metamask page for more details";
                    outputText("contractDeployStateArea", text);
                } else {


                    await move_finish();

                    text = "Contract-deploy successful!";
                    outputText("contractDeployStateArea", text);

                    contractAddress = receipt.contractAddress;

                    text = "Here is your unique contract address: " + contractAddress;
                    outputText("contractAddressArea", text);

                    // store the contract address to the database
                    pushSellerContract(sellerAddress, contractAddress); 
                    
                    // store the contract address and seller address to local storage and ensure the next page can access them
                    localStorage.setItem('contractAddress', contractAddress);
                    localStorage.setItem('sellerAddress', account);

                    var button = document.getElementById("addItem");
                    button.style.visibility = "visible";
                    
                }
                
            });
            
            /* funtion of the moving bar */
            async function move() {
                var text = document.getElementById("myProgress");
                var elem = document.getElementById("myBar");
                text.style.opacity = 1.0;
                elem.style.opacity = 1.0;
                
                i = 1;
                var width = 10;
                var id = setInterval(frame, 10);
                function frame() {
                if (width >= 90) {
                    clearInterval(id);
                    i = 0;
                } else {
                    width = width + 0.07;
                    elem.style.width = width + "%";
                    elem.innerHTML = Number((width).toFixed(1))  + "%";
                    }   
                }
                
            }
            
            async function move_finish() {
                var text = document.getElementById("myProgress");
                var elem = document.getElementById("myBar");
                text.style.opacity = 1.0;
                elem.style.opacity = 1.0;
                
                i = 1;
                var width = 90;
                var id = setInterval(frame, 10);
                function frame() {
                if (width >= 100) {
                    clearInterval(id);
                    i = 0;
                } else {
                    width = width + 0.08;
                    elem.style.width = width + "%";
                    elem.innerHTML = Number((width).toFixed(1))  + "%";
                    }   
                }
                
            }
            
            async function pushSellerContract(sellerAddress, contractAddress) {

                const sellerContract = new Parse.Object("sellerContract");
   
                sellerContract.set("sellerAddress", sellerAddress);
                sellerContract.set("contractAddress", contractAddress);

                try {
                    let result = await sellerContract.save();

                } catch (error) {
                    alert(`Error: ${error.message}`);

                }
            } 
            
        }

        

    </script>

</body>

</html>