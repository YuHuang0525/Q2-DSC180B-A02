<html>
  <head>
<!--     <h1>Welcome To SmartExchange <br> An Escrow-backed Peer-to-Peer Marketplace for Decentralized E-Commerce
    </h1> -->
<!--     <div title="404">Welcome To SmartExchange <br> An Escrow-backed Peer-to-Peer Marketplace for Decentralized E-Commerce</div> -->

<div class='console-container'><span id='text'></span><div class='console-underscore' id='console'>&#95;</div></div>

    <link href="styleSIGN.css" rel="stylesheet" type="text/css">
     <link href="background.css" rel="stylesheet" type="text/css">
    <script type="text/javascript" src="https://npmcdn.com/parse/dist/parse.min.js"></script>
    <script>
      function navigateToGreetingPage() {
        window.location.href = "greeting.html";
      }
      function getRole() {
        return localStorage.getItem("role");
      }
    </script>
  </head>
  <body>


    <div id="signin-signup">
  <h2>Sign In</h2>
  <form>
    <div class="form-group">
      <label for="emailSI">Email:</label>
      <input type="email" id="emailSI" placeholder="Enter your email">
    </div>
    <div class="form-group">
      <label for="passwordSI">Password:</label>
      <input type="password" id="passwordSI" placeholder="Enter your password">
    </div>
    <button id="submitButtonSignIn">Sign In</button>
  </form>
  <p>Don't have an account? <a href="#" id="signup-link">Sign Up</a></p>
</div>

<!-- Sign-up Form -->
<div id="signup" style="display:none;">
  <h2>Sign Up</h2>
  <form>
    <div class="form-group">
      <label for="username">Username:</label>
      <input type="text" id="username" placeholder="Enter your username">
    </div>
    <div class="form-group">
      <label for="email">Email:</label>
      <input type="email" id="email" placeholder="Enter your email">
    </div>
    <div class="form-group">
      <label for="password">Password:</label>
      <input type="password" id="password" placeholder="Enter your password">
    </div>

    <div class="form-group">
      <label>Account Type:</label>
      <input type="radio" id="buyer" name="accountType" value="Buyer">
      <label for="buyer">Buyer</label>
      <input type="radio" id="seller" name="accountType" value="Seller">
      <label for="seller">Seller</label>
    </div>

    <button id="submitButtonSignUp">Sign Up</button>
  </form>
  <p>Already have an account? <a href="#" id="signin-link">Sign In</a></p>
</div>

<!--     <div id="signin-signup">
      <h3>Sign In</h3>
      <form>
        <input type="email" id="emailSI" placeholder="Email">
        <br><br>
        <input type="password" id="passwordSI" placeholder="Password">
        <br><br>
        <button id="submitButtonSignIn">Sign In</button>
      </form>
      <p>Don't have an account? <a href="#" id="signup-link">Sign Up</a></p>
    </div>
     -->
    <!-- Sign-up Form -->
<!--     <div id="signup" style="display:none;">
      <h3>Sign Up</h3>
      <form>
        <input id="username" type="text" placeholder="Username"/>
        <input id="email" type="email" placeholder="Email"/>
        <input id="password" type="password" placeholder="Password" />
        <button id="submitButtonSignUp">Sign Up</button>
      </form>
      <p>Already have an account? <a href="#" id="signin-link">Sign In</a></p>
    </div> -->
    
    <!-- JS for handling the Sign-in and Sign-up Forms -->
    <script>
      Parse.initialize("rgzBD2oDrFGwnP4GhepGqvLTb4zxUCVA8ISU94G6", "rbN8I2nlk462haH28HHxwAka3o02oVqWWz1PrFdi");
      Parse.serverURL = "https://parseapi.back4app.com/";


      // function([string1, string2],target id,[color1,color2])    
 consoleText(['Welcome to SmartExchange', 'An Escrow-backed Peer-to-Peer Marketplace for Decentralized E-Commerce'], 'text',['rebeccapurple','rebeccapurple']);

//  function sleep(ms) {
//   return new Promise(resolve => setTimeout(resolve, ms));
// }

function consoleText(words, id, colors) {
  if (colors === undefined) colors = ['#fff'];
  var visible = true;
  var con = document.getElementById('console');
  var letterCount = 1;
  var x = 1;
  var waiting = false;
  var target = document.getElementById(id)
  target.setAttribute('style', 'color:' + colors[0])
  window.setInterval(function() {

    if (letterCount === 0 && waiting === false) {
      waiting = true;
      target.innerHTML = words[0].substring(0, letterCount)
      window.setTimeout(function() {
        var usedColor = colors.shift();
        colors.push(usedColor);
        var usedWord = words.shift();
        words.push(usedWord);
        x = 1;
        target.setAttribute('style', 'color:' + colors[0])
        letterCount += x;
        waiting = false;
      }, 1000)
    } else if (letterCount === words[0].length + 1 && waiting === false) {
      waiting = true;
      window.setTimeout(function() {
        x = -1;
        letterCount += x;
        waiting = false;
      }, 3500)
    } else if (waiting === false) {
      target.innerHTML = words[0].substring(0, letterCount)
      letterCount += x;
    }

  }, 20)
  window.setInterval(function() {
    if (visible === true) {
      con.className = 'console-underscore hidden'
      visible = false;

    } else {
      con.className = 'console-underscore'

      visible = true;
    }
  }, 400)
}


                    // Get the radio buttons
      const buyerRadioButton = document.getElementById("buyer");
      const sellerRadioButton = document.getElementById("seller");

      // Add event listeners to the radio buttons
      buyerRadioButton.addEventListener("change", handleRadioButtonChange);
      sellerRadioButton.addEventListener("change", handleRadioButtonChange);

      function handleRadioButtonChange(event) {
      // Get the selected radio button value
      const selectedValue = event.target.value;
      console.log("Selected account type: " + selectedValue);
      }


      
      async function signInUser() {
        try {
          const user = await Parse.User.logIn(document.getElementById("emailSI").value, document.getElementById("passwordSI").value);
          if (user !== null) {
            alert(`Successfully logged in as ${user.get("username")}`);
            await navigateToGreetingPage();
          }
        } catch (error) {
          alert(`Error: ${error.message}`);
        }
      }
      
      async function createParseUser() {
        let user = new Parse.User();

        user.set("username", document.getElementById("username").value);
        user.set("email", document.getElementById("email").value);
        user.set("password", document.getElementById("password").value);

        // Retrieve the selected radio button value and set it as the user's role
        const buyerRadioButton = document.getElementById("buyer");
        const sellerRadioButton = document.getElementById("seller");
        let role;
        if (buyerRadioButton.checked) {
        role = "Buyer";
        } else if (sellerRadioButton.checked) {
        role = "Seller";
        }else {
        alert(`Please select an account type.`);
        return;
        }
        user.set("role", role);
        localStorage.setItem("Role", role);

        try {
          user = await user.save();
          
          if (user !== null) {
            await alert(`New object created with success! ObjectId: ${user.id}, ${user.get("username")}`);
            await navigateToGreetingPage();
          }
        } catch (error) {
          alert(`Error: ${error.message}`);
        }
      }

      // Show Sign-up Form when "Sign Up" is clicked
      document.getElementById("signup-link").addEventListener("click", function() {
        document.getElementById("signin-signup").style.display = "none";
        document.getElementById("signup").style.display = "block";
      });
    
    // Show Sign-in Form when "Sign In" is clicked
    document.getElementById("signin-link").addEventListener("click", function() {
      document.getElementById("signup").style.display = "none";
      document.getElementById("signin-signup").style.display = "block";
    });

        document.getElementById("submitButtonSignUp").addEventListener("click", async function(event) {
  event.preventDefault(); // prevent the form from submitting
  createParseUser();
});

document.getElementById("submitButtonSignIn").addEventListener("click", async function(event) {
  event.preventDefault(); // prevent the form from submitting
  signInUser();
});

  </script>
  </body>
</html>

